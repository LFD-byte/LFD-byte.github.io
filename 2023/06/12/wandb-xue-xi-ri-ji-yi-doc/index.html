<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="WandB å­¦ä¹ æ—¥è®°ï¼ˆä¸€ï¼‰Tutorials, åŸ¹æ ¹è¯·åŠ è›‹">
    <meta name="description" content="WandB å­¦ä¹ æ—¥è®°ï¼ˆä¸€ï¼‰Tutorials">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google-site-verification" content="qvBHqgbyc_CYw3ZE9lrEIxYSUzkcL8LH9-_uDtcme5A" />
    <meta name="baidu-site-verification" content="codeva-mJZ2sqHuqv" />
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>WandB å­¦ä¹ æ—¥è®°ï¼ˆä¸€ï¼‰Tutorials | åŸ¹æ ¹è¯·åŠ è›‹</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    


    
    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="åŸ¹æ ¹è¯·åŠ è›‹" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">åŸ¹æ ¹è¯·åŠ è›‹</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>ç•™è¨€æ¿</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="æ·±è‰²/æµ…è‰²æ¨¡å¼" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">åŸ¹æ ¹è¯·åŠ è›‹</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			ç•™è¨€æ¿
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/LFD-byte" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/LFD-byte" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">WandB å­¦ä¹ æ—¥è®°ï¼ˆä¸€ï¼‰Tutorials</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/WandB/">
                                <span class="chip bg-color">WandB</span>
                            </a>
                        
                            <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">
                                <span class="chip bg-color">æ·±åº¦å­¦ä¹ </span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/WandB/" class="post-category">
                                WandB
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2023-06-12
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>æ›´æ–°æ—¥æœŸ:&nbsp;&nbsp;
                    2023-06-13
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    9.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    43 åˆ†
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="track-experiments">Track experiments</h2>
<p>å¿«é€Ÿå®éªŒæ˜¯æœºå™¨å­¦ä¹ çš„åŸºç¡€ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ W&amp;B
æ¥è·Ÿè¸ªå’Œå¯è§†åŒ–å®éªŒï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å¿«é€Ÿè¿­ä»£å’Œç†è§£æˆ‘ä»¬çš„ç»“æœã€‚</p>
<h3 id="a-shared-dashboard-for-your-experiments">A shared dashboard for
your experiments</h3>
<p>åªéœ€å‡ è¡Œä»£ç ï¼Œæ‚¨å°±å¯ä»¥è·å¾—ä¸°å¯Œçš„ã€äº¤äº’å¼çš„ã€å¯å…±äº«çš„ä»ªè¡¨æ¿ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°<a target="_blank" rel="noopener" href="https://wandb.ai/wandb/wandb_example?_gl=1*1ycseye*_ga*MTUwMzMwNTA4NC4xNjg1MzI0NjI3*_ga_JH1SJHJQXJ*MTY4NjU0ODg1NC40LjEuMTY4NjU1MDE0OC41MC4wLjA.">è‡ªå·±çš„
dashboard</a>ã€‚</p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefinedPell4Oo.png" alt="dashboard">
<figcaption aria-hidden="true">dashboard</figcaption>
</figure>
<h3 id="data-privacy">Data &amp; Privacy</h3>
<p>æˆ‘ä»¬éå¸¸é‡è§†å®‰å…¨æ€§ï¼Œæˆ‘ä»¬çš„äº‘æ‰˜ç®¡ dashboard
ä½¿ç”¨è¡Œä¸šæ ‡å‡†æœ€ä½³åŠ å¯†å®è·µã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨æ— æ³•ç¦»å¼€ä¼ä¸šé›†ç¾¤çš„æ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›<a target="_blank" rel="noopener" href="https://docs.wandb.com/self-hosted">æœ¬åœ°å®‰è£…</a>ã€‚</p>
<p>ä¸‹è½½æ‰€æœ‰æ•°æ®å¹¶å°†å…¶å¯¼å‡ºåˆ°å…¶ä»–å·¥å…·ä¹Ÿå¾ˆå®¹æ˜“â€”â€”ä¾‹å¦‚åœ¨ Jupyter
ç¬”è®°æœ¬ä¸­è¿›è¡Œè‡ªå®šä¹‰åˆ†æã€‚ä¸‹é¢æ˜¯å…³äºæˆ‘ä»¬ <a target="_blank" rel="noopener" href="https://docs.wandb.com/library/api">API</a> çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="install-wandb-library-and-login">Install <code>wandb</code>
library and login</h3>
<p>é¦–å…ˆå®‰è£…åº“å¹¶ç™»å½•åˆ°æ‚¨çš„å…è´¹å¸æˆ·ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install wandb <span class="at">-qU</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log in to your W&amp;B account</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>wandb.login()</span></code></pre></div>
<h3 id="run-an-experiment">Run an experiment</h3>
<p>1ï¸âƒ£. å¼€å§‹æ–°çš„è¿è¡Œå¹¶ä¼ å…¥è¶…å‚æ•°è¿›è¡Œè·Ÿè¸ª</p>
<p>2ï¸âƒ£. è®­ç»ƒæˆ–è¯„ä¼°çš„æ—¥å¿—æŒ‡æ ‡</p>
<p>3ï¸âƒ£. åœ¨ dashboard ä¸­å¯è§†åŒ–ç»“æœ</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch 5 simulated experiments</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>total_runs <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> run <span class="kw">in</span> <span class="bu">range</span>(total_runs):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ğŸ 1ï¸âƒ£ Start a new run to track this script</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  wandb.init(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set the project where this run will be logged</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      project<span class="op">=</span><span class="st">"basic-intro"</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># We pass a run name (otherwise itâ€™ll be randomly assigned, like sunshine-lollypop-10)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      name<span class="op">=</span><span class="ss">f"experiment_</span><span class="sc">{</span>run<span class="sc">}</span><span class="ss">"</span>, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Track hyperparameters and run metadata</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      config<span class="op">=</span>{</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"learning_rate"</span>: <span class="fl">0.02</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"architecture"</span>: <span class="st">"CNN"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"dataset"</span>: <span class="st">"CIFAR-100"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"epochs"</span>: <span class="dv">10</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This simple block simulates a training loop logging metrics</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  epochs <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  offset <span class="op">=</span> random.random() <span class="op">/</span> <span class="dv">5</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, epochs):</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      acc <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">**</span> <span class="op">-</span>epoch <span class="op">-</span> random.random() <span class="op">/</span> epoch <span class="op">-</span> offset</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      loss <span class="op">=</span> <span class="dv">2</span> <span class="op">**</span> <span class="op">-</span>epoch <span class="op">+</span> random.random() <span class="op">/</span> epoch <span class="op">+</span> offset</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ğŸ 2ï¸âƒ£ Log metrics from your script to W&amp;B</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      wandb.log({<span class="st">"acc"</span>: acc, <span class="st">"loss"</span>: loss})</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mark the run as finished</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  wandb.finish()</span></code></pre></div>
<p>3ï¸âƒ£ å½“æ‚¨è¿è¡Œæ­¤ä»£ç æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡å•å‡»ä¸Šé¢çš„ä»»ä½• ğŸ‘† wandb
é“¾æ¥æ‰¾åˆ°æ‚¨çš„äº¤äº’å¼ dashboardã€‚</p>
<h3 id="simple-pytorch-neural-network">Simple Pytorch Neural
Network</h3>
<p>è¿è¡Œæ­¤æ¨¡å‹ä»¥è®­ç»ƒä¸€ä¸ªç®€å•çš„ MNIST
åˆ†ç±»å™¨ï¼Œç„¶åå•å‡»é¡¹ç›®é¡µé¢é“¾æ¥ä»¥å®æ—¶æŸ¥çœ‹æ‚¨çš„ç»“æœæµåˆ° W&amp;B é¡¹ç›®ã€‚</p>
<p>wandb ä¸­çš„ä»»ä½•è¿è¡Œéƒ½ä¼šè‡ªåŠ¨è®°å½• <a target="_blank" rel="noopener" href="https://docs.wandb.ai/ref/app/pages/run-page#charts-tab">metrics</a>,
<a target="_blank" rel="noopener" href="https://docs.wandb.ai/ref/app/pages/run-page#system-tab">system
information</a>, <a target="_blank" rel="noopener" href="https://docs.wandb.ai/ref/app/pages/run-page#overview-tab">hyperparameters</a>,
<a target="_blank" rel="noopener" href="https://docs.wandb.ai/ref/app/pages/run-page#logs-tab">terminal
output</a> ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåŒ…å«æ¨¡å‹è¾“å…¥å’Œè¾“å‡ºçš„äº¤äº’å¼è¡¨æ ¼ã€‚</p>
<h4 id="set-up-dataloader">Set up Dataloader</h4>
<p>è¦è¿è¡Œæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… PyTorchã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Google
Colabï¼Œåˆ™å®ƒå·²ç»é¢„è£…ã€‚</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install torch torchvision</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch, torchvision</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.transforms <span class="im">as</span> T</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> <span class="st">"cuda:0"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_dataloader(is_train, batch_size, <span class="bu">slice</span><span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Get a training dataloader"</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    full_dataset <span class="op">=</span> torchvision.datasets.MNIST(root<span class="op">=</span><span class="st">"."</span>, train<span class="op">=</span>is_train, transform<span class="op">=</span>T.ToTensor(), download<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    sub_dataset <span class="op">=</span> torch.utils.data.Subset(full_dataset, indices<span class="op">=</span><span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(full_dataset), <span class="bu">slice</span>))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    loader <span class="op">=</span> torch.utils.data.DataLoader(dataset<span class="op">=</span>sub_dataset, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                         batch_size<span class="op">=</span>batch_size, </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                         shuffle<span class="op">=</span><span class="va">True</span> <span class="cf">if</span> is_train <span class="cf">else</span> <span class="va">False</span>, </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                         pin_memory<span class="op">=</span><span class="va">True</span>, num_workers<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> loader</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_model(dropout):</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">"A simple model"</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> nn.Sequential(nn.Flatten(),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                         nn.Linear(<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>, <span class="dv">256</span>),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                         nn.BatchNorm1d(<span class="dv">256</span>),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                         nn.ReLU(),</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                         nn.Dropout(dropout),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                         nn.Linear(<span class="dv">256</span>,<span class="dv">10</span>)).to(device)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> validate_model(model, valid_dl, loss_func, log_images<span class="op">=</span><span class="va">False</span>, batch_idx<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Compute performance of the model on the validation dataset and log a wandb.Table"</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    val_loss <span class="op">=</span> <span class="fl">0.</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.inference_mode():</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, (images, labels) <span class="kw">in</span> <span class="bu">enumerate</span>(valid_dl):</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            images, labels <span class="op">=</span> images.to(device), labels.to(device)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Forward pass â¡</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model(images)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            val_loss <span class="op">+=</span> loss_func(outputs, labels)<span class="op">*</span>labels.size(<span class="dv">0</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Compute accuracy and accumulate</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>            _, predicted <span class="op">=</span> torch.<span class="bu">max</span>(outputs.data, <span class="dv">1</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>            correct <span class="op">+=</span> (predicted <span class="op">==</span> labels).<span class="bu">sum</span>().item()</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log one batch of images to the dashboard, always same batch_idx.</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">==</span>batch_idx <span class="kw">and</span> log_images:</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                log_image_table(images, predicted, labels, outputs.softmax(dim<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val_loss <span class="op">/</span> <span class="bu">len</span>(valid_dl.dataset), correct <span class="op">/</span> <span class="bu">len</span>(valid_dl.dataset)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_image_table(images, predicted, labels, probs):</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Log a wandb.Table with (img, pred, target, scores)"</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ğŸ Create a wandb Table to log images, labels and predictions to</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> wandb.Table(columns<span class="op">=</span>[<span class="st">"image"</span>, <span class="st">"pred"</span>, <span class="st">"target"</span>]<span class="op">+</span>[<span class="ss">f"score_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)])</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> img, pred, targ, prob <span class="kw">in</span> <span class="bu">zip</span>(images.to(<span class="st">"cpu"</span>), predicted.to(<span class="st">"cpu"</span>), labels.to(<span class="st">"cpu"</span>), probs.to(<span class="st">"cpu"</span>)):</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        table.add_data(wandb.Image(img[<span class="dv">0</span>].numpy()<span class="op">*</span><span class="dv">255</span>), pred, targ, <span class="op">*</span>prob.numpy())</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    wandb.log({<span class="st">"predictions_table"</span>:table}, commit<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
<h4 id="train-your-model">Train Your Model</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch 5 experiments, trying different dropout rates</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ğŸ initialise a wandb run</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    wandb.init(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        project<span class="op">=</span><span class="st">"pytorch-intro"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>{</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"epochs"</span>: <span class="dv">10</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"batch_size"</span>: <span class="dv">128</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lr"</span>: <span class="fl">1e-3</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"dropout"</span>: random.uniform(<span class="fl">0.01</span>, <span class="fl">0.80</span>),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Copy your config </span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    config <span class="op">=</span> wandb.config</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the data</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    train_dl <span class="op">=</span> get_dataloader(is_train<span class="op">=</span><span class="va">True</span>, batch_size<span class="op">=</span>config.batch_size)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    valid_dl <span class="op">=</span> get_dataloader(is_train<span class="op">=</span><span class="va">False</span>, batch_size<span class="op">=</span><span class="dv">2</span><span class="op">*</span>config.batch_size)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    n_steps_per_epoch <span class="op">=</span> math.ceil(<span class="bu">len</span>(train_dl.dataset) <span class="op">/</span> config.batch_size)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A simple MLP model</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> get_model(config.dropout)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the loss and optimizer</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    loss_func <span class="op">=</span> nn.CrossEntropyLoss()</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span>config.lr)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Training</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    example_ct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    step_ct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(config.epochs):</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        model.train()</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> step, (images, labels) <span class="kw">in</span> <span class="bu">enumerate</span>(train_dl):</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>            images, labels <span class="op">=</span> images.to(device), labels.to(device)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model(images)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            train_loss <span class="op">=</span> loss_func(outputs, labels)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>            optimizer.zero_grad()</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>            train_loss.backward()</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            optimizer.step()</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>            example_ct <span class="op">+=</span> <span class="bu">len</span>(images)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>            metrics <span class="op">=</span> {<span class="st">"train/train_loss"</span>: train_loss, </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"train/epoch"</span>: (step <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> (n_steps_per_epoch <span class="op">*</span> epoch)) <span class="op">/</span> n_steps_per_epoch, </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"train/example_ct"</span>: example_ct}</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> step <span class="op">+</span> <span class="dv">1</span> <span class="op">&lt;</span> n_steps_per_epoch:</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ğŸ Log train metrics to wandb </span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                wandb.log(metrics)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>            step_ct <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        val_loss, accuracy <span class="op">=</span> validate_model(model, valid_dl, loss_func, log_images<span class="op">=</span>(epoch<span class="op">==</span>(config.epochs<span class="op">-</span><span class="dv">1</span>)))</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ğŸ Log train and validation metrics to wandb</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>        val_metrics <span class="op">=</span> {<span class="st">"val/val_loss"</span>: val_loss, </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"val/val_accuracy"</span>: accuracy}</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>        wandb.log({<span class="op">**</span>metrics, <span class="op">**</span>val_metrics})</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Train Loss: </span><span class="sc">{</span>train_loss<span class="sc">:.3f}</span><span class="ss">, Valid Loss: </span><span class="sc">{</span>val_loss<span class="sc">:3f}</span><span class="ss">, Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If you had a test set, this is how you could log it as a Summary metric</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    wandb.summary[<span class="st">'test_accuracy'</span>] <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ğŸ Close your wandb run </span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    wandb.finish()</span></code></pre></div>
<p>æ‚¨ç°åœ¨å·²ç»ä½¿ç”¨ wandb è®­ç»ƒäº†æ‚¨çš„ç¬¬ä¸€ä¸ªæ¨¡å‹ï¼ ğŸ‘† å•å‡»ä¸Šé¢çš„ wandb
é“¾æ¥æŸ¥çœ‹æ‚¨çš„æŒ‡æ ‡</p>
<h3 id="try-wb-alerts">Try W&amp;B Alerts</h3>
<p><strong><a target="_blank" rel="noopener" href="https://docs.wandb.ai/guides/track/alert">W&amp;B
Alerts</a></strong> å…è®¸æ‚¨å°†ä» Python ä»£ç è§¦å‘çš„è­¦æŠ¥å‘é€åˆ°æ‚¨çš„ Slack
æˆ–ç”µå­é‚®ä»¶ã€‚ç¬¬ä¸€æ¬¡å‘é€ Slack æˆ–ç”µå­é‚®ä»¶è­¦æŠ¥æ—¶ï¼Œéœ€è¦æ‰§è¡Œ 2
ä¸ªæ­¥éª¤ï¼Œè¿™äº›è­¦æŠ¥ç”±æ‚¨çš„ä»£ç è§¦å‘ï¼š</p>
<p>1) åœ¨ä½ çš„ W&amp;B <a target="_blank" rel="noopener" href="https://wandb.ai/settings">User
Settings</a> å¼€å¯è­¦æŠ¥</p>
<p>2) æ·»åŠ  <code>wandb.alert()</code> åˆ°ä½ çš„ä»£ç :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>wandb.alert(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Low accuracy"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="ss">f"Accuracy is below the acceptable threshold"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>è¯·å‚é˜…ä¸‹é¢çš„æœ€å°ç¤ºä¾‹ä»¥äº†è§£å¦‚ä½•ä½¿ç”¨ wandb.alertï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ° <a target="_blank" rel="noopener" href="https://docs.wandb.ai/guides/track/alert">W&amp;B
Alerts</a>çš„å®Œæ•´æ–‡æ¡£</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start a wandb run</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>wandb.init(project<span class="op">=</span><span class="st">"pytorch-intro"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulating a model training loop</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>acc_threshold <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> training_step <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate a random number for accuracy</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> <span class="bu">round</span>(random.random() <span class="op">+</span> random.random(), <span class="dv">3</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Accuracy is: </span><span class="sc">{</span>accuracy<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>acc_threshold<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ğŸ Log accuracy to wandb</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    wandb.log({<span class="st">"Accuracy"</span>: accuracy})</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ğŸ”” If the accuracy is below the threshold, fire a W&amp;B Alert and stop the run</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> accuracy <span class="op">&lt;=</span> acc_threshold:</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ğŸ Send the wandb Alert</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        wandb.alert(</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            title<span class="op">=</span><span class="st">'Low Accuracy'</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span><span class="ss">f'Accuracy </span><span class="sc">{</span>accuracy<span class="sc">}</span><span class="ss"> at step </span><span class="sc">{</span>training_step<span class="sc">}</span><span class="ss"> is below the acceptable theshold, </span><span class="sc">{</span>acc_threshold<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Alert triggered'</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark the run as finished (useful in Jupyter notebooks)</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code></pre></div>
<h2 id="visualize-predictions">Visualize predictions</h2>
<p>è¿™åŒ…æ‹¬å¦‚ä½•åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨ PyTorch å¯¹ MNIST
æ•°æ®è¿›è¡Œè·Ÿè¸ªã€å¯è§†åŒ–å’Œæ¯”è¾ƒæ¨¡å‹é¢„æµ‹ã€‚</p>
<p>ä½ å°†å­¦åˆ°å¦‚ä½•ï¼š</p>
<ol type="1">
<li>åœ¨æ¨¡å‹è®­ç»ƒæˆ–è¯„ä¼°æœŸé—´å°†æŒ‡æ ‡ã€å›¾åƒã€æ–‡æœ¬ç­‰è®°å½•åˆ°
<code>wandb.Table()</code></li>
<li>æŸ¥çœ‹ã€æ’åºã€ç­›é€‰ã€åˆ†ç»„ã€åŠ å…¥ã€äº¤äº’å¼æŸ¥è¯¢å’Œæ¢ç´¢è¿™äº›è¡¨</li>
<li>æ¯”è¾ƒæ¨¡å‹é¢„æµ‹æˆ–ç»“æœï¼šåŠ¨æ€åœ°è·¨è¶Šç‰¹å®šå›¾åƒã€è¶…å‚æ•°/æ¨¡å‹ç‰ˆæœ¬æˆ–æ—¶é—´æ­¥é•¿ã€‚</li>
</ol>
<h3 id="examples">Examples</h3>
<h4 id="compare-predicted-scores-for-specific-images">Compare predicted
scores for specific images</h4>
<p><a target="_blank" rel="noopener" href="https://wandb.ai/stacey/table-quickstart/reports/CNN-2-Progress-over-Training-Time--Vmlldzo3NDY5ODU?_gl=1*6z1980*_ga*MTUwMzMwNTA4NC4xNjg1MzI0NjI3*_ga_JH1SJHJQXJ*MTY4NjU0ODg1NC40LjEuMTY4NjU1MTg0Ni4zOC4wLjA.#compare-predictions-after-1-vs-5-epochs">å®ä¾‹ï¼šæ¯”è¾ƒ
1 å’Œ 5 ä¸ªè®­ç»ƒå‘¨æœŸåçš„é¢„æµ‹</a></p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefinedNMme6Qj.png" alt="1 epoch vs 5 epochs of training">
<figcaption aria-hidden="true">1 epoch vs 5 epochs of
training</figcaption>
</figure>
<p>ç›´æ–¹å›¾æ¯”è¾ƒäº†ä¸¤ä¸ªæ¨¡å‹ä¹‹é—´çš„æ¯ç±»åˆ†æ•°ã€‚æ¯ä¸ªç›´æ–¹å›¾ä¸­é¡¶éƒ¨çš„ç»¿è‰²æ¡ä»£è¡¨æ¨¡å‹â€œCNN-2,
1 epochâ€ï¼ˆid 0ï¼‰ï¼Œå®ƒåªè®­ç»ƒäº† 1 ä¸ª epochã€‚åº•éƒ¨çš„ç´«è‰²æ¡ä»£è¡¨æ¨¡å‹â€œCNN-2, 5
epochsâ€ (id 1)ï¼Œå®ƒè®­ç»ƒäº† 5 ä¸ª
epochsã€‚å›¾åƒè¢«è¿‡æ»¤åˆ°æ¨¡å‹ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œåœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œâ€œ4â€åœ¨ 1
ä¸ªæ—¶æœŸååœ¨æ‰€æœ‰å¯èƒ½çš„æ•°å­—ä¸­è·å¾—é«˜åˆ†ï¼Œä½†åœ¨ 5
ä¸ªæ—¶æœŸåï¼Œå®ƒåœ¨æ­£ç¡®æ ‡ç­¾ä¸Šå¾—åˆ†æœ€é«˜ï¼Œè€Œåœ¨å…¶ä½™éƒ¨åˆ†å¾—åˆ†éå¸¸ä½ã€‚</p>
<h4 id="focus-on-top-errors-over-time">Focus on top errors over
time</h4>
<p><a target="_blank" rel="noopener" href="https://wandb.ai/stacey/table-quickstart/reports/CNN-2-Progress-over-Training-Time--Vmlldzo3NDY5ODU?_gl=1*1nxbzl7*_ga*MTUwMzMwNTA4NC4xNjg1MzI0NjI3*_ga_JH1SJHJQXJ*MTY4NjU0ODg1NC40LjEuMTY4NjU1MTg0Ni4zOC4wLjA.#top-errors-over-time">å®ä¾‹
â†’</a></p>
<p>æŸ¥çœ‹å®Œæ•´æµ‹è¯•æ•°æ®çš„ä¸æ­£ç¡®é¢„æµ‹ï¼ˆè¿‡æ»¤ "guess" != "truth"
çš„è¡Œï¼‰ã€‚è¯·æ³¨æ„ï¼Œåœ¨ 1 ä¸ªè®­ç»ƒæ—¶æœŸåæœ‰ 229 ä¸ªé”™è¯¯çŒœæµ‹ï¼Œä½†åœ¨ 5 ä¸ªæ—¶æœŸååªæœ‰
98 ä¸ªã€‚</p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefined7g8nodn.png" alt="side by side, 1 vs 5 epochs of training">
<figcaption aria-hidden="true">side by side, 1 vs 5 epochs of
training</figcaption>
</figure>
<h4 id="compare-model-performance-and-find-patterns">Compare model
performance and find patterns</h4>
<p><a target="_blank" rel="noopener" href="https://wandb.ai/stacey/table-quickstart/reports/CNN-2-Progress-over-Training-Time--Vmlldzo3NDY5ODU?_gl=1*8r828v*_ga*MTUwMzMwNTA4NC4xNjg1MzI0NjI3*_ga_JH1SJHJQXJ*MTY4NjU0ODg1NC40LjEuMTY4NjU1MTg0Ni4zOC4wLjA.#false-positives-grouped-by-guess">æŸ¥çœ‹å®ä¾‹ä¸­çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯
â†’</a></p>
<p>è¿‡æ»¤å‡ºæ­£ç¡®ç­”æ¡ˆï¼Œç„¶åæŒ‰çŒœæµ‹åˆ†ç»„ï¼Œä»¥æŸ¥çœ‹é”™è¯¯åˆ†ç±»å›¾åƒçš„ç¤ºä¾‹å’ŒçœŸå®æ ‡ç­¾çš„åŸºæœ¬åˆ†å¸ƒâ€”â€”å¹¶æ’æ˜¾ç¤ºä¸¤ä¸ªæ¨¡å‹ã€‚å…·æœ‰
2X layer sizes
å’Œå­¦ä¹ ç‡çš„æ¨¡å‹å˜ä½“åœ¨å·¦ä¾§ï¼ŒåŸºçº¿åœ¨å³ä¾§ã€‚è¯·æ³¨æ„ï¼Œå¯¹äºæ¯ä¸ªçŒœæµ‹çš„ç±»ï¼ŒåŸºçº¿éƒ½ä¼šçŠ¯æ›´å¤šçš„é”™è¯¯ã€‚</p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefinedi5PP9AE.png" alt="grouped errors for baseline vs double variant">
<figcaption aria-hidden="true">grouped errors for baseline vs double
variant</figcaption>
</figure>
<h3 id="sign-up-or-login">Sign up or login</h3>
<p><a target="_blank" rel="noopener" href="https://wandb.ai/login">Sign up or login</a> W&amp;B
ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ‚¨çš„å®éªŒå¹¶ä¸ä¹‹äº’åŠ¨ã€‚</p>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Google Colab
ä½œä¸ºæ–¹ä¾¿çš„æ‰˜ç®¡ç¯å¢ƒï¼Œä½†æ‚¨å¯ä»¥ä»ä»»ä½•åœ°æ–¹è¿è¡Œè‡ªå·±çš„è®­ç»ƒè„šæœ¬ï¼Œå¹¶ä½¿ç”¨ W&amp;B
çš„å®éªŒè·Ÿè¸ªå·¥å…·å¯è§†åŒ–æŒ‡æ ‡ã€‚</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install wandb <span class="at">-qqq</span></span></code></pre></div>
<p>ç™»å½•æ‚¨çš„å¸æˆ·</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>wandb.login()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>WANDB_PROJECT <span class="op">=</span> <span class="st">"mnist-viz"</span></span></code></pre></div>
<h3 id="setup">0. Setup</h3>
<p>å®‰è£…ä¾èµ–é¡¹ï¼Œä¸‹è½½ MNISTï¼Œå¹¶ä½¿ç”¨ PyTorch åˆ›å»ºè®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†ã€‚</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.transforms <span class="im">as</span> T </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> <span class="st">"cuda:0"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create train and test dataloaders</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_dataloader(is_train, batch_size, <span class="bu">slice</span><span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Get a training dataloader"</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    ds <span class="op">=</span> torchvision.datasets.MNIST(root<span class="op">=</span><span class="st">"."</span>, train<span class="op">=</span>is_train, transform<span class="op">=</span>T.ToTensor(), download<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    loader <span class="op">=</span> torch.utils.data.DataLoader(dataset<span class="op">=</span>ds, </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                                         batch_size<span class="op">=</span>batch_size, </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                                         shuffle<span class="op">=</span><span class="va">True</span> <span class="cf">if</span> is_train <span class="cf">else</span> <span class="va">False</span>, </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                                         pin_memory<span class="op">=</span><span class="va">True</span>, num_workers<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> loader</span></code></pre></div>
<h3 id="define-the-model-and-training-schedule">1. Define the model and
training schedule</h3>
<ul>
<li>è®¾ç½®è¦è¿è¡Œçš„çºªå…ƒæ•°ï¼Œå…¶ä¸­æ¯ä¸ªçºªå…ƒåŒ…å«ä¸€ä¸ªè®­ç»ƒæ­¥éª¤å’Œä¸€ä¸ªéªŒè¯ï¼ˆæµ‹è¯•ï¼‰æ­¥éª¤ã€‚
ï¼ˆå¯é€‰ï¼‰é…ç½®æ¯ä¸ªæµ‹è¯•æ­¥éª¤è¦è®°å½•çš„æ•°æ®é‡ã€‚è¿™é‡Œè¦å¯è§†åŒ–çš„æ‰¹æ¬¡æ•°å’Œæ¯æ‰¹æ¬¡çš„å›¾åƒæ•°è®¾ç½®å¾—è¾ƒä½ï¼Œä»¥ç®€åŒ–æ¼”ç¤ºã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªç®€å•çš„å·ç§¯ç¥ç»ç½‘ç»œï¼ˆéµå¾ª <a target="_blank" rel="noopener" href="https://github.com/yunjey/pytorch-tutorial">pytorch-tutorial</a>
ä»£ç ï¼‰ã€‚</li>
<li>ä½¿ç”¨ PyTorch åŠ è½½è®­ç»ƒé›†å’Œæµ‹è¯•é›†</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of epochs to run</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Each epoch includes a training step and a test step, so this sets</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the number of tables of test predictions to log</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of batches to log from the test data for each test step</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (default set low to simplify demo)</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>NUM_BATCHES_TO_LOG <span class="op">=</span> <span class="dv">10</span> <span class="co">#79</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of images to log per test batch</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (default set low to simplify demo)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>NUM_IMAGES_PER_BATCH <span class="op">=</span> <span class="dv">32</span> <span class="co">#128</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># training configuration and hyperparameters</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>NUM_CLASSES <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>LEARNING_RATE <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>L1_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>L2_SIZE <span class="op">=</span> <span class="dv">64</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># changing this may require changing the shape of adjacent layers</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>CONV_KERNEL_SIZE <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># define a two-layer convolutional neural network</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConvNet(nn.Module):</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, num_classes<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(ConvNet, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.layer1 <span class="op">=</span> nn.Sequential(</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">1</span>, L1_SIZE, CONV_KERNEL_SIZE, stride<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(L1_SIZE),</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(kernel_size<span class="op">=</span><span class="dv">2</span>, stride<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.layer2 <span class="op">=</span> nn.Sequential(</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(L1_SIZE, L2_SIZE, CONV_KERNEL_SIZE, stride<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(L2_SIZE),</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>            nn.MaxPool2d(kernel_size<span class="op">=</span><span class="dv">2</span>, stride<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc <span class="op">=</span> nn.Linear(<span class="dv">7</span><span class="op">*</span><span class="dv">7</span><span class="op">*</span>L2_SIZE, NUM_CLASSES)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.softmax <span class="op">=</span> nn.Softmax(NUM_CLASSES)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># uncomment to see the shape of a given layer:</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print("x: ", x.size())</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> <span class="va">self</span>.layer1(x)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> <span class="va">self</span>.layer2(out)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> out.reshape(out.size(<span class="dv">0</span>), <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> <span class="va">self</span>.fc(out)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> get_dataloader(is_train<span class="op">=</span><span class="va">True</span>, batch_size<span class="op">=</span>BATCH_SIZE)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>test_loader <span class="op">=</span> get_dataloader(is_train<span class="op">=</span><span class="va">False</span>, batch_size<span class="op">=</span><span class="dv">2</span><span class="op">*</span>BATCH_SIZE)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda:0"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span></code></pre></div>
<h3 id="run-training-and-log-test-predictions">2. Run training and log
test predictions</h3>
<p>å¯¹äºæ¯ä¸ªæ—¶æœŸï¼Œè¿è¡Œä¸€ä¸ªè®­ç»ƒæ­¥éª¤å’Œä¸€ä¸ªæµ‹è¯•æ­¥éª¤ã€‚å¯¹äºæ¯ä¸ªæµ‹è¯•æ­¥éª¤ï¼Œåˆ›å»ºä¸€ä¸ª
wandb.Table()
æ¥å­˜å‚¨æµ‹è¯•é¢„æµ‹ã€‚è¿™äº›å¯ä»¥åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­è¿›è¡Œå¯è§†åŒ–ã€åŠ¨æ€æŸ¥è¯¢å’Œå¹¶æ’æ¯”è¾ƒã€‚</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ¨ W&amp;B: Initialize a new run to track this model's training</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>wandb.init(project<span class="op">=</span><span class="st">"table-quickstart"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ¨ W&amp;B: Log hyperparameters using config</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>cfg <span class="op">=</span> wandb.config</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>cfg.update({<span class="st">"epochs"</span> : EPOCHS, <span class="st">"batch_size"</span>: BATCH_SIZE, <span class="st">"lr"</span> : LEARNING_RATE,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"l1_size"</span> : L1_SIZE, <span class="st">"l2_size"</span>: L2_SIZE,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"conv_kernel"</span> : CONV_KERNEL_SIZE,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"img_count"</span> : <span class="bu">min</span>(<span class="dv">10000</span>, NUM_IMAGES_PER_BATCH<span class="op">*</span>NUM_BATCHES_TO_LOG)})</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># define model, loss, and optimizer</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> ConvNet(NUM_CLASSES).to(device)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.CrossEntropyLoss()</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span>LEARNING_RATE)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># convenience funtion to log predictions for a batch of test images</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_test_predictions(images, labels, outputs, predicted, test_table, log_counter):</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># obtain confidence scores for all classes</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  scores <span class="op">=</span> F.softmax(outputs.data, dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  log_scores <span class="op">=</span> scores.cpu().numpy()</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  log_images <span class="op">=</span> images.cpu().numpy()</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  log_labels <span class="op">=</span> labels.cpu().numpy()</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  log_preds <span class="op">=</span> predicted.cpu().numpy()</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adding ids based on the order of the images</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  _id <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i, l, p, s <span class="kw">in</span> <span class="bu">zip</span>(log_images, log_labels, log_preds, log_scores):</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add required info to data table:</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># id, image pixels, model's guess, true label, scores for all classes</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    img_id <span class="op">=</span> <span class="bu">str</span>(_id) <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(log_counter)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    test_table.add_data(img_id, wandb.Image(i), p, l, <span class="op">*</span>s)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    _id <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> _id <span class="op">==</span> NUM_IMAGES_PER_BATCH:</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># train the model</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>total_step <span class="op">=</span> <span class="bu">len</span>(train_loader)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(EPOCHS):</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># training step</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (images, labels) <span class="kw">in</span> <span class="bu">enumerate</span>(train_loader):</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        images <span class="op">=</span> images.to(device)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels.to(device)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># forward pass</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(images)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> criterion(outputs, labels)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># backward and optimize</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># âœ¨ W&amp;B: Log loss over training steps, visualized in the UI live</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        wandb.log({<span class="st">"loss"</span> : loss})</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (i<span class="op">+</span><span class="dv">1</span>) <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span> (<span class="st">'Epoch [</span><span class="sc">{}</span><span class="st">/</span><span class="sc">{}</span><span class="st">], Step [</span><span class="sc">{}</span><span class="st">/</span><span class="sc">{}</span><span class="st">], Loss: </span><span class="sc">{:.4f}</span><span class="st">'</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>                .<span class="bu">format</span>(epoch<span class="op">+</span><span class="dv">1</span>, EPOCHS, i<span class="op">+</span><span class="dv">1</span>, total_step, loss.item()))</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># âœ¨ W&amp;B: Create a Table to store predictions for each test step</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">"id"</span>, <span class="st">"image"</span>, <span class="st">"guess"</span>, <span class="st">"truth"</span>]</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> digit <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>      columns.append(<span class="st">"score_"</span> <span class="op">+</span> <span class="bu">str</span>(digit))</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    test_table <span class="op">=</span> wandb.Table(columns<span class="op">=</span>columns)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># test the model</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    log_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> images, labels <span class="kw">in</span> test_loader:</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>            images <span class="op">=</span> images.to(device)</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>            labels <span class="op">=</span> labels.to(device)</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model(images)</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>            _, predicted <span class="op">=</span> torch.<span class="bu">max</span>(outputs.data, <span class="dv">1</span>)</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> log_counter <span class="op">&lt;</span> NUM_BATCHES_TO_LOG:</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>              log_test_predictions(images, labels, outputs, predicted, test_table, log_counter)</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>              log_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>            total <span class="op">+=</span> labels.size(<span class="dv">0</span>)</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>            correct <span class="op">+=</span> (predicted <span class="op">==</span> labels).<span class="bu">sum</span>().item()</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>        acc <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> correct <span class="op">/</span> total</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># âœ¨ W&amp;B: Log accuracy across training epochs, to visualize in the UI</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>        wandb.log({<span class="st">"epoch"</span> : epoch, <span class="st">"acc"</span> : acc})</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Test Accuracy of the model on the 10000 test images: </span><span class="sc">{}</span><span class="st"> %'</span>.<span class="bu">format</span>(acc))</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># âœ¨ W&amp;B: Log predictions table to wandb</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>    wandb.log({<span class="st">"test_predictions"</span> : test_table})</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="co"># âœ¨ W&amp;B: Mark the run as complete (useful for multi-cell notebook)</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>wandb.finish()</span></code></pre></div>
<h2 id="tune-hyperparameters">Tune hyperparameters</h2>
<p><a target="_blank" rel="noopener" href="https://colab.research.google.com/github/wandb/examples/blob/master/colabs/pytorch/Organizing_Hyperparameter_Sweeps_in_PyTorch_with_W&amp;B.ipynb">åœ¨æ­¤å¤„è¯•ç”¨
Colab Notebook â†’</a></p>
<p>åœ¨é«˜ç»´è¶…å‚æ•°ç©ºé—´ä¸­æœç´¢ä»¥æ‰¾åˆ°æ€§èƒ½æœ€é«˜çš„æ¨¡å‹å¯èƒ½ä¼šå¾ˆå¿«å˜å¾—ç¬¨æ‹™ã€‚è¶…å‚æ•°æ‰«ææä¾›äº†ä¸€ç§æœ‰ç»„ç»‡ä¸”é«˜æ•ˆçš„æ–¹å¼æ¥è¿›è¡Œæ¨¡å‹å¤§é€ƒæ€å¹¶é€‰æ‹©æœ€å‡†ç¡®çš„æ¨¡å‹ã€‚ä»–ä»¬é€šè¿‡è‡ªåŠ¨æœç´¢è¶…å‚æ•°å€¼çš„ç»„åˆï¼ˆä¾‹å¦‚
learning rate, batch size, number of hidden layers, optimizer
typeï¼‰æ¥æ‰¾åˆ°æœ€ä½³å€¼æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Weights &amp; Biases é€šè¿‡ 3
ä¸ªç®€å•æ­¥éª¤è¿è¡Œå¤æ‚çš„è¶…å‚æ•°æ‰«æã€‚</p>
<h3 id="follow-along-with-a-video-tutorial">Follow along with a <a target="_blank" rel="noopener" href="http://wandb.me/sweeps-video">video tutorial</a>!</h3>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefinedWVKkMWw.png" alt="tune hyperparameters">
<figcaption aria-hidden="true">tune hyperparameters</figcaption>
</figure>
<h3 id="setup-1">Setup</h3>
<p>é¦–å…ˆå®‰è£…å®éªŒè·Ÿè¸ªåº“å¹¶è®¾ç½®æ‚¨çš„å…è´¹ W&amp;B å¸æˆ·ï¼š</p>
<ol type="1">
<li>ä½¿ç”¨ <code>pip install</code> å®‰è£…</li>
<li><code>import</code> Python æ‰€éœ€ä¾èµ–</li>
<li><code>.login()</code> è¿™æ ·æ‚¨å°±å¯ä»¥å°†æŒ‡æ ‡è®°å½•åˆ°æ‚¨çš„é¡¹ç›®ä¸­</li>
</ol>
<p>å¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡ Weights &amp;
Biasesï¼Œç™»å½•ç”µè¯ä¼šç»™æ‚¨ä¸€ä¸ªæ³¨å†Œå¸æˆ·çš„é“¾æ¥ã€‚ W&amp;B
å¯å…è´¹ç”¨äºä¸ªäººå’Œå­¦æœ¯é¡¹ç›®ï¼</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">!pip</span> install wandb <span class="at">-Uq</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>wandb.login()</span></code></pre></div>
<h3 id="step-1.-define-the-sweep">Step 1ï¸âƒ£. Define the Sweep</h3>
<p>ä»æ ¹æœ¬ä¸Šè¯´ï¼ŒSweep
å°†å°è¯•ä¸€å †è¶…å‚æ•°å€¼çš„ç­–ç•¥ä¸è¯„ä¼°å®ƒä»¬çš„ä»£ç ç»“åˆåœ¨ä¸€èµ·ã€‚æ‚¨åªéœ€è¦ä»¥<a target="_blank" rel="noopener" href="https://docs.wandb.com/sweeps/configuration">é…ç½®</a>çš„å½¢å¼å®šä¹‰æ‚¨çš„ç­–ç•¥ã€‚</p>
<p>å½“æ‚¨åƒè¿™æ ·åœ¨ç¬”è®°æœ¬ä¸­è®¾ç½® Sweep
æ—¶ï¼Œè¯¥é…ç½®å¯¹è±¡æ˜¯ä¸€ä¸ªåµŒå¥—å­—å…¸ã€‚å½“æ‚¨é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œ Sweep
æ—¶ï¼Œé…ç½®å¯¹è±¡æ˜¯ä¸€ä¸ª <a target="_blank" rel="noopener" href="https://docs.wandb.com/sweeps/quickstart#2-sweep-config">YAML
file</a>ã€‚</p>
<p>è®©æˆ‘ä»¬ä¸€èµ·äº†è§£ Sweep
é…ç½®çš„å®šä¹‰ã€‚æˆ‘ä»¬ä¼šæ…¢æ…¢æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰æœºä¼šè§£é‡Šæ¯ä¸ªç»„ä»¶ã€‚åœ¨å…¸å‹çš„ Sweep
ç®¡é“ä¸­ï¼Œæ­¤æ­¥éª¤å°†åœ¨å•ä¸ªåˆ†é…ä¸­å®Œæˆã€‚</p>
<h4 id="pick-a-method">Pick a <code>method</code></h4>
<p>æˆ‘ä»¬éœ€è¦å®šä¹‰çš„ç¬¬ä¸€ä»¶äº‹æ˜¯é€‰æ‹©æ–°å‚æ•°å€¼çš„ <code>method</code>ã€‚</p>
<p>æˆ‘ä»¬æä¾›ä»¥ä¸‹æœç´¢ <code>methods</code>ï¼š</p>
<ul>
<li><strong><code>grid</code> Search </strong>â€“
è¿­ä»£è¶…å‚æ•°å€¼çš„æ¯ä¸ªç»„åˆã€‚éå¸¸æœ‰æ•ˆï¼Œä½†è®¡ç®—é‡å¤§ã€‚</li>
<li><strong><code>random</code> Search</strong> â€“ æ ¹æ®æä¾›çš„
<code>distribution</code> éšæœºé€‰æ‹©æ¯ä¸ªæ–°ç»„åˆã€‚å‡ºä¹æ„æ–™çš„æœ‰æ•ˆï¼</li>
<li><strong><code>bayesian</code> Search</strong> â€“
åˆ›å»ºä¸€ä¸ªåº¦é‡åˆ†æ•°ä½œä¸ºè¶…å‚æ•°å‡½æ•°çš„æ¦‚ç‡æ¨¡å‹ï¼Œå¹¶é€‰æ‹©å…·æœ‰æé«˜åº¦é‡çš„é«˜æ¦‚ç‡çš„å‚æ•°ã€‚é€‚ç”¨äºå°‘é‡è¿ç»­å‚æ•°ä½†æ‰©å±•æ€§å·®ã€‚</li>
</ul>
<p><code>random</code> æ–¹æ³•ï¼š</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sweep_config <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'method'</span>: <span class="st">'random'</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>å¯¹äº <code>bayesian</code> Sweepsï¼Œæ‚¨è¿˜éœ€è¦å‘Šè¯‰æˆ‘ä»¬ä¸€äº›å…³äºæ‚¨çš„
metric
çš„ä¿¡æ¯ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“å®ƒçš„åç§°ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡å‹è¾“å‡ºä¸­æ‰¾åˆ°å®ƒï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ‚¨çš„ç›®æ ‡æ˜¯æœ€å°åŒ–å®ƒï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå®ƒæ˜¯
squared errorï¼‰è¿˜æ˜¯æœ€å¤§åŒ–å®ƒï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå®ƒæ˜¯ accuracyï¼‰ã€‚</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>metric <span class="op">=</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'name'</span>: <span class="st">'loss'</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'goal'</span>: <span class="st">'minimize'</span>   </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>sweep_config[<span class="st">'metric'</span>] <span class="op">=</span> metric</span></code></pre></div>
<p>å¦‚æœæ‚¨æ²¡æœ‰è¿è¡Œ <code>bayesian</code>
Sweepï¼Œåˆ™ä¸å¿…è¿™æ ·åšï¼Œä½†æ— è®ºå¦‚ä½•å°†å…¶åŒ…å«åœ¨æ‚¨çš„ <code>sweep_config</code>
ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œä»¥é˜²æ‚¨ä»¥åæ”¹å˜ä¸»æ„ã€‚è®°å½•è¿™æ ·çš„äº‹æƒ…ä¹Ÿæ˜¯å¾ˆå¥½çš„å†ç°æ€§å®è·µï¼Œä»¥é˜²ä¸‡ä¸€æ‚¨æˆ–å…¶ä»–äººåœ¨
6 ä¸ªæœˆæˆ– 6 å¹´åå›åˆ°æ‚¨çš„ Sweep å¹¶ä¸”ä¸çŸ¥é“ <code>val_G_batch</code>
åº”è¯¥æ˜¯é«˜è¿˜æ˜¯ä½ã€‚</p>
<h4 id="name-the-hyperparameters">Name the
hyper<code>parameters</code></h4>
<p>ä¸€æ—¦æ‚¨é€‰æ‹©äº†ä¸€ç§ <code>method</code>
æ¥å°è¯•è¶…å‚æ•°çš„æ–°å€¼ï¼Œæ‚¨éœ€è¦å®šä¹‰è¿™äº› <code>parameters</code>æ˜¯ä»€ä¹ˆ</p>
<p>å¤§å¤šæ•°æ—¶å€™ï¼Œè¿™ä¸€æ­¥å¾ˆç®€å•ï¼šæ‚¨åªéœ€ä¸º <code>parameter</code>
å‘½åå¹¶æŒ‡å®šå‚æ•°çš„åˆæ³• <code>values</code> åˆ—è¡¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ç½‘ç»œé€‰æ‹© <code>optimizer</code>
æ—¶ï¼Œåªæœ‰æœ‰é™æ•°é‡çš„é€‰é¡¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åšæŒä½¿ç”¨ä¸¤ä¸ªæœ€å—æ¬¢è¿çš„é€‰æ‹©ï¼Œ<code>adam</code>
å’Œ
<code>sgd</code>ã€‚å³ä½¿å¯¹äºå…·æœ‰æ½œåœ¨æ— é™é€‰é¡¹çš„è¶…å‚æ•°ï¼Œé€šå¸¸ä¹Ÿåªå°è¯•å‡ ä¸ªé€‰æ‹©
<code>values</code> æ‰æœ‰æ„ä¹‰ï¼Œå°±åƒæˆ‘ä»¬åœ¨æ­¤å¤„å¯¹éšè—å±‚
<code>layer_size</code> å’Œ <code>dropout</code> æ‰€åšçš„é‚£æ ·ã€‚</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>parameters_dict <span class="op">=</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'optimizer'</span>: {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'values'</span>: [<span class="st">'adam'</span>, <span class="st">'sgd'</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fc_layer_size'</span>: {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'values'</span>: [<span class="dv">128</span>, <span class="dv">256</span>, <span class="dv">512</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'dropout'</span>: {</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'values'</span>: [<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>sweep_config[<span class="st">'parameters'</span>] <span class="op">=</span> parameters_dict</span></code></pre></div>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæœ‰äº›è¶…å‚æ•°æˆ‘ä»¬ä¸æƒ³åœ¨æ­¤ Sweep ä¸­æ”¹å˜ï¼Œä½†æˆ‘ä»¬ä»å¸Œæœ›åœ¨æˆ‘ä»¬çš„
<code>sweep_config</code> ä¸­è®¾ç½®å®ƒä»¬ã€‚</p>
<p>åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥è®¾ç½® <code>value</code>ï¼š</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>parameters_dict.update({</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'epochs'</span>: {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'value'</span>: <span class="dv">1</span>}</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>å¯¹äº <code>grid</code> æœç´¢ï¼Œè¿™å°±æ˜¯æ‚¨æ‰€éœ€è¦çš„ã€‚</p>
<p>å¯¹äº <code>random</code> æœç´¢ï¼Œå‚æ•°çš„æ‰€æœ‰ <code>values</code>
åœ¨ç»™å®šè¿è¡Œä¸­è¢«é€‰æ‹©çš„å¯èƒ½æ€§ç›¸åŒã€‚</p>
<p>å¦‚æœè¿™æ ·åšä¸è¡Œï¼Œæ‚¨å¯ä»¥æ”¹ä¸ºæŒ‡å®šå‘½å <code>distribution</code>
åŠå…¶å‚æ•°ï¼Œä¾‹å¦‚ <code>normal</code> åˆ†å¸ƒçš„å‡å€¼ <code>mu</code> å’Œæ ‡å‡†å·®
<code>sigma</code>ã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://docs.wandb.com/sweeps/configuration#distributions">æ­¤å¤„</a>æŸ¥çœ‹æœ‰å…³å¦‚ä½•è®¾ç½®éšæœºå˜é‡åˆ†å¸ƒçš„æ›´å¤šä¿¡æ¯ã€‚</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>parameters_dict.update({</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># a flat distribution between 0 and 0.1</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'distribution'</span>: <span class="st">'uniform'</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="dv">0</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="fl">0.1</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'batch_size'</span>: {</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># integers between 32 and 256</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># with evenly-distributed logarithms </span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'distribution'</span>: <span class="st">'q_log_uniform_values'</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'q'</span>: <span class="dv">8</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'min'</span>: <span class="dv">32</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max'</span>: <span class="dv">256</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>å½“æˆ‘ä»¬å®Œæˆåï¼Œ<code>sweep_config</code>
æ˜¯ä¸€ä¸ªåµŒå¥—çš„å­—å…¸ï¼Œå®ƒå‡†ç¡®åœ°æŒ‡å®šäº†æˆ‘ä»¬æœ‰å…´è¶£å°è¯•å“ªäº›
<code>parameters</code> ä»¥åŠæˆ‘ä»¬å°†ä½¿ç”¨ä»€ä¹ˆ <code>method</code>
æ¥å°è¯•å®ƒä»¬ã€‚</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pprint</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>pprint.pprint(sweep_config)</span></code></pre></div>
<p>ä½†è¿™ä¸æ˜¯æ‰€æœ‰çš„é…ç½®é€‰é¡¹ï¼</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1603.06560.pdf">HyperBand</a> è°ƒåº¦ç®—æ³•
<code>early_terminate</code> è¿è¡Œçš„é€‰é¡¹ã€‚åœ¨<a target="_blank" rel="noopener" href="https://docs.wandb.com/sweeps/configuration#stopping-criteria">è¿™é‡Œ</a>æŸ¥çœ‹æ›´å¤šã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://docs.wandb.com/library/sweeps/configuration">æ­¤å¤„</a>æ‰¾åˆ°æ‰€æœ‰é…ç½®é€‰é¡¹çš„åˆ—è¡¨ï¼Œå¹¶åœ¨<a target="_blank" rel="noopener" href="https://github.com/wandb/examples/tree/master/examples/keras/keras-cnn-fashion">æ­¤å¤„</a>æ‰¾åˆ°å¤§é‡
YAML æ ¼å¼çš„ç¤ºä¾‹ã€‚</p>
<h3 id="step-2.-initialize-the-sweep">Step 2ï¸âƒ£. Initialize the Sweep</h3>
<p>ä¸€æ—¦æ‚¨å®šä¹‰äº†æœç´¢ç­–ç•¥ï¼Œå°±è¯¥è®¾ç½®ä¸€äº›ä¸œè¥¿æ¥å®ç°å®ƒäº†ã€‚</p>
<p>è´Ÿè´£æˆ‘ä»¬ Sweep çš„ clockwork taskmaster è¢«ç§°ä¸º <em>Sweep
Controller</em>ã€‚æ¯æ¬¡è¿è¡Œå®Œæˆæ—¶ï¼Œå®ƒå°†å‘å‡ºä¸€ç»„æ–°çš„æŒ‡ä»¤æ¥æè¿°è¦æ‰§è¡Œçš„æ–°è¿è¡Œã€‚è¿™äº›æŒ‡ä»¤ç”±å®é™…æ‰§è¡Œè¿è¡Œçš„
<em>agents</em> è·å–ã€‚</p>
<p>åœ¨å…¸å‹çš„ Sweep ä¸­ï¼ŒController
ä½äºæˆ‘ä»¬çš„æœºå™¨ä¸Šï¼Œè€Œå®Œæˆè¿è¡Œçš„ä»£ç†ä½äºæ‚¨çš„æœºå™¨ä¸Šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™ç§åˆ†å·¥ä½¿å¾—åªéœ€æ·»åŠ æ›´å¤šæœºå™¨æ¥è¿è¡Œä»£ç†å°±å¯ä»¥éå¸¸å®¹æ˜“åœ°æ‰©å±•
Sweepsï¼</p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefinedzlbw3vQ.png" alt="sweeps-diagram">
<figcaption aria-hidden="true">sweeps-diagram</figcaption>
</figure>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é€‚å½“çš„ <code>sweep_config</code> å’Œ
<code>project</code> åç§°è°ƒç”¨ <code>wandb.sweep</code> æ¥ç»“æŸ Sweep
Controllerã€‚</p>
<p>æ­¤å‡½æ•°è¿”å›ä¸€ä¸ª <code>sweep_id</code>ï¼Œæˆ‘ä»¬ç¨åå°†ä½¿ç”¨å®ƒæ¥å°† agents
åˆ†é…ç»™æ­¤ Controllerã€‚</p>
<p>æ—æ³¨ï¼šåœ¨å‘½ä»¤è¡Œä¸Šï¼Œæ­¤åŠŸèƒ½è¢«æ›¿æ¢ä¸º</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">wandb</span> sweep config.yaml</span></code></pre></div>
<p><a target="_blank" rel="noopener" href="https://docs.wandb.com/sweeps/quickstart">äº†è§£æ›´å¤šå…³äºåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨
Sweeps â¡</a></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sweep_id <span class="op">=</span> wandb.sweep(sweep_config, project<span class="op">=</span><span class="st">"pytorch-sweeps-demo"</span>)</span></code></pre></div>
<h3 id="step-3.-run-the-sweep-agent">Step 3ï¸âƒ£. Run the Sweep agent</h3>
<h4 id="define-your-training-procedure">Define Your Training
Procedure</h4>
<p>åœ¨æˆ‘ä»¬å®é™…æ‰§è¡Œ sweep ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä½¿ç”¨è¿™äº›å€¼çš„è®­ç»ƒè¿‡ç¨‹ã€‚</p>
<p>åœ¨ä¸‹é¢çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åœ¨ PyTorch
ä¸­å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œå¹¶æ·»åŠ äº†ä»¥ä¸‹ <code>wandb</code>
å·¥å…·æ¥è®°å½•æ¨¡å‹æŒ‡æ ‡ã€å¯è§†åŒ–æ€§èƒ½å’Œè¾“å‡ºå¹¶è·Ÿè¸ªæˆ‘ä»¬çš„å®éªŒï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.wandb.com/library/init"><strong><code>wandb.init()</code></strong></a>
â€“ åˆå§‹åŒ–æ–°çš„ W&amp;B è¿è¡Œã€‚æ¯æ¬¡è¿è¡Œéƒ½æ˜¯è®­ç»ƒåŠŸèƒ½çš„ä¸€æ¬¡æ‰§è¡Œã€‚</li>
<li><a target="_blank" rel="noopener" href="https://docs.wandb.com/library/config"><strong><code>wandb.config</code></strong></a>
â€“ å°†æ‰€æœ‰è¶…å‚æ•°ä¿å­˜åœ¨é…ç½®å¯¹è±¡ä¸­ï¼Œä»¥ä¾¿è®°å½•å®ƒä»¬ã€‚åœ¨<a target="_blank" rel="noopener" href="https://colab.research.google.com/github/wandb/examples/blob/master/colabs/wandb-config/Configs_in_W%26B.ipynb">æ­¤å¤„</a>é˜…è¯»æœ‰å…³å¦‚ä½•ä½¿ç”¨
<code>wandb.config</code> çš„æ›´å¤šä¿¡æ¯ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://docs.wandb.com/library/log"><strong><code>wandb.log()</code></strong></a>
â€“ å°†æ¨¡å‹è¡Œä¸ºè®°å½•åˆ° W&amp;Bã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªè®°å½•æ€§èƒ½ï¼›æœ‰å…³å¯ä»¥ä½¿ç”¨
<code>wandb.log</code> è®°å½•çš„æ‰€æœ‰å…¶ä»–å¯Œåª’ä½“ï¼Œè¯·å‚é˜…æ­¤ <a target="_blank" rel="noopener" href="https://colab.research.google.com/github/wandb/examples/blob/master/colabs/wandb-log/Log_(Almost)_Anything_with_W%26B_Media.ipynb">Colab</a>ã€‚</li>
</ul>
<p>æœ‰å…³ä½¿ç”¨ PyTorch æ£€æµ‹ W&amp;B çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤ <a target="_blank" rel="noopener" href="https://colab.research.google.com/github/wandb/examples/blob/master/colabs/pytorch/Simple_PyTorch_Integration.ipynb">Colab</a>ã€‚</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torchvision <span class="im">import</span> datasets, transforms</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(config<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize a new wandb run</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> wandb.init(config<span class="op">=</span>config):</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If called by wandb.agent, as below,</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># this config will be set by Sweep Controller</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        config <span class="op">=</span> wandb.config</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        loader <span class="op">=</span> build_dataset(config.batch_size)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        network <span class="op">=</span> build_network(config.fc_layer_size, config.dropout)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        optimizer <span class="op">=</span> build_optimizer(network, config.optimizer, config.learning_rate)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(config.epochs):</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>            avg_loss <span class="op">=</span> train_epoch(network, loader, optimizer)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>            wandb.log({<span class="st">"loss"</span>: avg_loss, <span class="st">"epoch"</span>: epoch})           </span></code></pre></div>
<p>è¿™ä¸ªå•å…ƒæ ¼å®šä¹‰äº†æˆ‘ä»¬è®­ç»ƒè¿‡ç¨‹çš„å››ä¸ªéƒ¨åˆ†ï¼š<code>build_dataset</code>,
<code>build_network</code>, <code>build_optimizer</code>
å’Œ<code>train_epoch</code>.</p>
<p>æ‰€æœ‰è¿™äº›éƒ½æ˜¯åŸºæœ¬ PyTorch ç®¡é“çš„æ ‡å‡†éƒ¨åˆ†ï¼Œå®ƒä»¬çš„å®ç°ä¸å—ä½¿ç”¨ W&amp;B
çš„å½±å“ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šå¯¹å®ƒä»¬å‘è¡¨è¯„è®ºã€‚</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_dataset(batch_size):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    transform <span class="op">=</span> transforms.Compose(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        [transforms.ToTensor(),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>         transforms.Normalize((<span class="fl">0.1307</span>,), (<span class="fl">0.3081</span>,))])</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># download MNIST training dataset</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> datasets.MNIST(<span class="st">"."</span>, train<span class="op">=</span><span class="va">True</span>, download<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                             transform<span class="op">=</span>transform)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    sub_dataset <span class="op">=</span> torch.utils.data.Subset(</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        dataset, indices<span class="op">=</span><span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(dataset), <span class="dv">5</span>))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    loader <span class="op">=</span> torch.utils.data.DataLoader(sub_dataset, batch_size<span class="op">=</span>batch_size)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> loader</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_network(fc_layer_size, dropout):</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    network <span class="op">=</span> nn.Sequential(  <span class="co"># fully-connected, single hidden layer</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        nn.Flatten(),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        nn.Linear(<span class="dv">784</span>, fc_layer_size), nn.ReLU(),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        nn.Dropout(dropout),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        nn.Linear(fc_layer_size, <span class="dv">10</span>),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        nn.LogSoftmax(dim<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> network.to(device)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_optimizer(network, optimizer, learning_rate):</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> optimizer <span class="op">==</span> <span class="st">"sgd"</span>:</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        optimizer <span class="op">=</span> optim.SGD(network.parameters(),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>                              lr<span class="op">=</span>learning_rate, momentum<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> optimizer <span class="op">==</span> <span class="st">"adam"</span>:</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        optimizer <span class="op">=</span> optim.Adam(network.parameters(),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>                               lr<span class="op">=</span>learning_rate)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> optimizer</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_epoch(network, loader, optimizer):</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    cumu_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, (data, target) <span class="kw">in</span> <span class="bu">enumerate</span>(loader):</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>        data, target <span class="op">=</span> data.to(device), target.to(device)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># â¡ Forward pass</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> F.nll_loss(network(data), target)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>        cumu_loss <span class="op">+=</span> loss.item()</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># â¬… Backward pass + weight update</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>        wandb.log({<span class="st">"batch loss"</span>: loss.item()})</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cumu_loss <span class="op">/</span> <span class="bu">len</span>(loader)</span></code></pre></div>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡å¼€å§‹ sweeping äº†ï¼</p>
<p>Sweep Controllersï¼Œå°±åƒæˆ‘ä»¬é€šè¿‡è¿è¡Œ <code>wandb.sweep</code>
åˆ¶ä½œçš„æ§åˆ¶å™¨ä¸€æ ·ï¼Œåç­‰æœ‰äººè¦æ±‚ä»–ä»¬æä¾› <code>config</code>æ¥è¯•ç”¨ã€‚</p>
<p>æŸäººæ˜¯ <code>agent</code>ï¼Œä»–ä»¬æ˜¯ç”¨ <code>wandb.agent</code>
åˆ›å»ºçš„ã€‚è¦å¼€å§‹ï¼Œagent åªéœ€è¦çŸ¥é“</p>
<ol type="1">
<li>å®ƒæ˜¯ (<code>sweep_id</code>) çš„ä¸€éƒ¨åˆ†</li>
<li>å®ƒåº”è¯¥è¿è¡Œå“ªä¸ªå‡½æ•°ï¼ˆè¿™é‡Œæ˜¯ <code>train</code>ï¼‰</li>
<li>ï¼ˆå¯é€‰ï¼‰æœ‰å¤šå°‘é…ç½®è¦æ±‚æ§åˆ¶å™¨ï¼ˆ<code>count</code>ï¼‰</li>
</ol>
<p>ä»…ä¾›å‚è€ƒï¼Œæ‚¨å¯ä»¥åœ¨ä¸åŒçš„è®¡ç®—èµ„æºä¸Šå¯åŠ¨å…·æœ‰ç›¸åŒ <code>sweep_id</code>
çš„å¤šä¸ª <code>agent</code>ï¼ŒController å°†ç¡®ä¿å®ƒä»¬æ ¹æ®
<code>sweep_config</code>
ä¸­åˆ¶å®šçš„ç­–ç•¥ååŒå·¥ä½œã€‚è¿™ä½¿å¾—åœ¨å°½å¯èƒ½å¤šçš„èŠ‚ç‚¹ä¸Šæ‰©å±• Sweeps
å˜å¾—è½»è€Œæ˜“ä¸¾ï¼</p>
<p>æ—æ³¨ï¼šåœ¨å‘½ä»¤è¡Œä¸Šï¼Œæ­¤åŠŸèƒ½è¢«æ›¿æ¢ä¸º</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">wandb</span> agent sweep_id</span></code></pre></div>
<p><a target="_blank" rel="noopener" href="https://docs.wandb.com/sweeps/quickstart">äº†è§£æ›´å¤šå…³äºåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨
Sweeps â¡</a></p>
<p>ä¸‹é¢çš„å•å…ƒæ ¼å°†å¯åŠ¨ä¸€ä¸ªè¿è¡Œ <code>train</code> 5 æ¬¡çš„
<code>agent</code>ï¼Œä½¿ç”¨ Sweep Controller
è¿”å›çš„éšæœºç”Ÿæˆçš„è¶…å‚æ•°å€¼ã€‚æ‰§è¡Œæ—¶é—´ä¸åˆ° 5 åˆ†é’Ÿã€‚</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>wandb.agent(sweep_id, train, count<span class="op">=</span><span class="dv">5</span>)</span></code></pre></div>
<h3 id="visualize-sweep-results">Visualize Sweep Results</h3>
<h4 id="parallel-coordinates-plot">Parallel Coordinates Plot</h4>
<p>æ­¤å›¾å°†è¶…å‚æ•°å€¼æ˜ å°„åˆ°æ¨¡å‹æŒ‡æ ‡ã€‚å®ƒå¯¹äºç£¨ç»ƒå¯¼è‡´æœ€ä½³æ¨¡å‹æ€§èƒ½çš„è¶…å‚æ•°ç»„åˆå¾ˆæœ‰ç”¨ã€‚</p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefined5e190366778ad831455f9af2_s_194708415DEC35F74A7691FF6810D3B14703D1EFE1672ED29000BA98171242A5_1578695138341_image.png" alt="hyperparameters map to metrics">
<figcaption aria-hidden="true">hyperparameters map to
metrics</figcaption>
</figure>
<h4 id="hyperparameter-importance-plot">Hyperparameter Importance
Plot</h4>
<p>è¶…å‚æ•°é‡è¦æ€§å›¾è¡¨æ˜å“ªäº›è¶…å‚æ•°æ˜¯æŒ‡æ ‡çš„æœ€ä½³é¢„æµ‹å› å­ã€‚æˆ‘ä»¬æŠ¥å‘Šç‰¹å¾é‡è¦æ€§ï¼ˆæ¥è‡ªéšæœºæ£®æ—æ¨¡å‹ï¼‰å’Œç›¸å…³æ€§ï¼ˆéšå¼çº¿æ€§æ¨¡å‹ï¼‰ã€‚</p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefined5e190367778ad820b35f9af5_s_194708415DEC35F74A7691FF6810D3B14703D1EFE1672ED29000BA98171242A5_1578695757573_image.png" alt="parameter importance">
<figcaption aria-hidden="true">parameter importance</figcaption>
</figure>
<p>è¿™äº›å¯è§†åŒ–å¯ä»¥é€šè¿‡ç£¨ç»ƒæœ€é‡è¦çš„å‚æ•°ï¼ˆå’Œå€¼èŒƒå›´ï¼‰æ¥å¸®åŠ©æ‚¨èŠ‚çœè¿è¡Œæ˜‚è´µçš„è¶…å‚æ•°ä¼˜åŒ–çš„æ—¶é—´å’Œèµ„æºï¼Œå› æ­¤å€¼å¾—è¿›ä¸€æ­¥æ¢ç´¢ã€‚</p>
<h3 id="get-your-hands-dirty-with-sweeps">Get your hands dirty with
sweeps</h3>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„è®­ç»ƒè„šæœ¬å’Œä¸€äº› <a target="_blank" rel="noopener" href="https://github.com/wandb/examples/tree/master/examples/keras/keras-cnn-fashion">sweep
configs</a> é£æ ¼ä¾›æ‚¨ä½¿ç”¨ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨å°è¯•ä¸€ä¸‹ã€‚</p>
<p>è¯¥å­˜å‚¨åº“è¿˜æä¾›äº†ä¸€äº›ç¤ºä¾‹ï¼Œå¯å¸®åŠ©æ‚¨å°è¯•æ›´é«˜çº§çš„ sweep åŠŸèƒ½ï¼Œä¾‹å¦‚ <a target="_blank" rel="noopener" href="https://app.wandb.ai/wandb/examples-keras-cnn-fashion/sweeps/us0ifmrf?workspace=user-lavanyashukla&amp;_gl=1*1h57q6p*_ga*MTUwMzMwNTA4NC4xNjg1MzI0NjI3*_ga_JH1SJHJQXJ*MTY4NjYyMjIyOS43LjAuMTY4NjYyMjIyOS42MC4wLjA.">Bayesian
Hyperband</a> å’Œ <a target="_blank" rel="noopener" href="https://app.wandb.ai/wandb/examples-keras-cnn-fashion/sweeps/xbs2wm5e?workspace=user-lavanyashukla&amp;_gl=1*5hk37j*_ga*MTUwMzMwNTA4NC4xNjg1MzI0NjI3*_ga_JH1SJHJQXJ*MTY4NjYyMjIyOS43LjAuMTY4NjYyMjIyOS42MC4wLjA.">Hyperopt</a>ã€‚</p>
<h2 id="track-models-and-datasets">Track models and datasets</h2>
<p><a target="_blank" rel="noopener" href="https://colab.research.google.com/github/wandb/examples/blob/master/colabs/wandb-artifacts/Pipeline_Versioning_with_W&amp;B_Artifacts.ipynb">åœ¨æ­¤å¤„è¯•ç”¨
Colab Notebook â†’</a></p>
<p>åœ¨æ­¤ç¬”è®°æœ¬ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ W&amp;B Artifacts è·Ÿè¸ªæ‚¨çš„ ML
å®éªŒç®¡é“ã€‚</p>
<h4 id="follow-along-with-a-video-tutorial-1">Follow along with a <a target="_blank" rel="noopener" href="http://tiny.cc/wb-artifacts-video">video tutorial</a>!</h4>
<h5 id="what-are-artifacts-and-why-should-i-care">What are Artifacts and
Why Should I Care?</h5>
<p>â€œartifactâ€ï¼Œå¦‚å¸Œè…ŠåŒè€³ç“¶ğŸºï¼Œæ˜¯ä¸€ä¸ªç”Ÿäº§çš„å¯¹è±¡â€”â€”ä¸€ä¸ªè¿‡ç¨‹çš„è¾“å‡ºã€‚åœ¨ ML
ä¸­ï¼Œæœ€é‡è¦çš„å·¥ä»¶æ˜¯ <em>datasets</em> å’Œ <em>models</em>ã€‚</p>
<p>è€Œä¸”ï¼Œå°±åƒ <a target="_blank" rel="noopener" href="https://indianajones.fandom.com/wiki/Cross_of_Coronado">Cross of
Coronado</a>
ä¸€æ ·ï¼Œè¿™äº›é‡è¦çš„æ–‡ç‰©å±äºåšç‰©é¦†ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”è¯¥å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç±»å’Œç»„ç»‡ï¼Œä»¥ä¾¿æ‚¨ã€æ‚¨çš„å›¢é˜Ÿå’Œæ•´ä¸ª
ML ç¤¾åŒºå¯ä»¥å‘å®ƒä»¬å­¦ä¹ ã€‚æ¯•ç«Ÿï¼Œé‚£äº›ä¸è·Ÿè¸ªè®­ç»ƒçš„äººæ³¨å®šè¦é‡è¹ˆè¦†è¾™ã€‚</p>
<p>ä½¿ç”¨æˆ‘ä»¬çš„ Artifacts APIï¼Œæ‚¨å¯ä»¥å°† <code>Artifacts</code> è®°å½•ä¸º
W&amp;B <code>Runs</code> çš„è¾“å‡ºï¼Œæˆ–ä½¿ç”¨ <code>Artifacts</code> ä½œä¸º
<code>Runs</code>
çš„è¾“å…¥ï¼Œå¦‚æ­¤å›¾æ‰€ç¤ºï¼Œå…¶ä¸­è®­ç»ƒè¿è¡Œæ¥å—æ•°æ®é›†å¹¶ç”Ÿæˆæ¨¡å‹ã€‚</p>
<figure>
<img src="https://blog-img-1304093596.cos.ap-shanghai.myqcloud.com/undefinedsimple%20artifact%20diagram%202.png" alt="simple artifact diagram">
<figcaption aria-hidden="true">simple artifact diagram</figcaption>
</figure>
<p>ç”±äºä¸€æ¬¡è¿è¡Œå¯ä»¥ä½¿ç”¨å¦ä¸€æ¬¡çš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œå› æ­¤ Artifacts å’Œ Runs
ä¸€èµ·å½¢æˆäº†ä¸€ä¸ªæœ‰å‘å›¾â€”â€”å®é™…ä¸Šæ˜¯ä¸€ä¸ªäºŒåˆ† <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">DAG</a>ï¼ --
å¸¦æœ‰ <code>Artifact</code>s å’Œ <code>Run</code>s çš„èŠ‚ç‚¹ï¼Œä»¥åŠå°†
<code>Run</code>s è¿æ¥åˆ°å®ƒä»¬æ¶ˆè€—æˆ–ç”Ÿäº§çš„ <code>Artifact</code>s
çš„ç®­å¤´ã€‚</p>
<h3 id="install-and-import">0ï¸âƒ£ Install and Import</h3>
<p>Artifacts æ˜¯æˆ‘ä»¬ Python åº“çš„ä¸€éƒ¨åˆ†ï¼Œä» <code>0.9.2</code>
ç‰ˆå¼€å§‹ã€‚</p>
<p>ä¸ ML Python å †æ ˆçš„å¤§å¤šæ•°éƒ¨åˆ†ä¸€æ ·ï¼Œå®ƒå¯ä»¥é€šè¿‡ <code>pip</code>
è·å¾—ã€‚</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compatible with wandb version 0.9.2+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install wandb <span class="op">-</span>qqq</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>apt install tree</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span></code></pre></div>
<h3 id="log-a-dataset">1ï¸âƒ£ Log a Dataset</h3>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€äº› Artifactsã€‚</p>
<p>æ­¤ç¤ºä¾‹åŸºäºæ­¤ PyTorch <a target="_blank" rel="noopener" href="https://github.com/pytorch/examples/tree/master/mnist/">"Basic
MNIST Example"</a>ï¼Œä½†å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="http://wandb.me/artifacts-colab">TensorFlow</a>ã€ä»»ä½•å…¶ä»–æ¡†æ¶æˆ–çº¯
Python ä¸­è½»æ¾å®Œæˆã€‚</p>
<p>æˆ‘ä»¬ä» <code>Dataset</code>s å¼€å§‹ï¼š</p>
<ul>
<li>ä¸€ä¸ª <code>train</code>ing setï¼Œç”¨äºé€‰æ‹©å‚æ•°ï¼Œ</li>
<li>ä¸€ä¸ª <code>validation</code> setï¼Œç”¨äºé€‰æ‹©è¶…å‚æ•°ï¼Œ</li>
<li>ä¸€ä¸ª <code>test</code>ing setï¼Œç”¨äºè¯„ä¼°æœ€ç»ˆæ¨¡å‹</li>
</ul>
<p>ä¸‹é¢çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼å®šä¹‰äº†è¿™ä¸‰ä¸ªæ•°æ®é›†ã€‚</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> TensorDataset</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure deterministic behavior</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>torch.backends.cudnn.deterministic <span class="op">=</span> <span class="va">True</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">0</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>torch.cuda.manual_seed_all(<span class="dv">0</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Device configuration</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda:0"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Data parameters</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>num_classes <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">28</span>, <span class="dv">28</span>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># drop slow mirror from list of MNIST mirrors</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>torchvision.datasets.MNIST.mirrors <span class="op">=</span> [mirror <span class="cf">for</span> mirror <span class="kw">in</span> torchvision.datasets.MNIST.mirrors</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                                      <span class="cf">if</span> <span class="kw">not</span> mirror.startswith(<span class="st">"http://yann.lecun.com"</span>)]</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load(train_size<span class="op">=</span><span class="dv">50_000</span>):</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">    # Load the data</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the data, split between train and test sets</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    train <span class="op">=</span> torchvision.datasets.MNIST(<span class="st">"./"</span>, train<span class="op">=</span><span class="va">True</span>, download<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> torchvision.datasets.MNIST(<span class="st">"./"</span>, train<span class="op">=</span><span class="va">False</span>, download<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    (x_train, y_train), (x_test, y_test) <span class="op">=</span> (train.data, train.targets), (test.data, test.targets)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split off a validation set for hyperparameter tuning</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    x_train, x_val <span class="op">=</span> x_train[:train_size], x_train[train_size:]</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    y_train, y_val <span class="op">=</span> y_train[:train_size], y_train[train_size:]</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    training_set <span class="op">=</span> TensorDataset(x_train, y_train)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    validation_set <span class="op">=</span> TensorDataset(x_val, y_val)</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    test_set <span class="op">=</span> TensorDataset(x_test, y_test)</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    datasets <span class="op">=</span> [training_set, validation_set, test_set]</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> datasets</span></code></pre></div>
<p>è¿™å»ºç«‹äº†ä¸€ä¸ªæ¨¡å¼ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°é‡å¤ï¼šå°†æ•°æ®è®°å½•ä¸ºå·¥ä»¶çš„ä»£ç åŒ…è£¹åœ¨ç”Ÿæˆè¯¥æ•°æ®çš„ä»£ç å‘¨å›´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨äº
<code>load</code>ing æ•°æ®çš„ä»£ç ä¸ç”¨äº <code>load_and_log</code>ging
æ•°æ®çš„ä»£ç åˆ†å¼€ã€‚</p>
<p>è¿™æ˜¯å¾ˆå¥½çš„åšæ³•ï¼</p>
<p>ä¸ºäº†å°†è¿™äº›æ•°æ®é›†è®°å½•ä¸ºå·¥ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦</p>
<ol type="1">
<li>ä½¿ç”¨ <code>wandb.init</code> åˆ›å»º <code>Run</code>ï¼Œ(L4)</li>
<li>ä¸ºæ•°æ®é›† (L10) åˆ›å»ºä¸€ä¸ª <code>Artifact</code>ï¼Œä»¥åŠ</li>
<li>ä¿å­˜å¹¶è®°å½•ç›¸å…³ <code>file</code>sï¼ˆL20ã€L23ï¼‰ã€‚</li>
</ol>
<p>æŸ¥çœ‹ä¸‹é¢ä»£ç å•å…ƒçš„ç¤ºä¾‹ï¼Œç„¶åå±•å¼€åé¢çš„éƒ¨åˆ†ä»¥äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_and_log():</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ğŸš€ start a run, with a type to label it and a project it can call home</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> wandb.init(project<span class="op">=</span><span class="st">"artifacts-example"</span>, job_type<span class="op">=</span><span class="st">"load-data"</span>) <span class="im">as</span> run:</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        datasets <span class="op">=</span> load()  <span class="co"># separate code for loading the datasets</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        names <span class="op">=</span> [<span class="st">"training"</span>, <span class="st">"validation"</span>, <span class="st">"test"</span>]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ğŸº create our Artifact</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        raw_data <span class="op">=</span> wandb.Artifact(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mnist-raw"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"dataset"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Raw MNIST dataset, split into train/val/test"</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>            metadata<span class="op">=</span>{<span class="st">"source"</span>: <span class="st">"torchvision.datasets.MNIST"</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"sizes"</span>: [<span class="bu">len</span>(dataset) <span class="cf">for</span> dataset <span class="kw">in</span> datasets]})</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> name, data <span class="kw">in</span> <span class="bu">zip</span>(names, datasets):</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ğŸ£ Store a new file in the artifact, and write something into its contents.</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> raw_data.new_file(name <span class="op">+</span> <span class="st">".pt"</span>, mode<span class="op">=</span><span class="st">"wb"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>                x, y <span class="op">=</span> data.tensors</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>                torch.save((x, y), <span class="bu">file</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># âœï¸ Save the artifact to W&amp;B.</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>        run.log_artifact(raw_data)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>load_and_log()</span></code></pre></div>
<h4 id="wandb.init">ğŸš€ <code>wandb.init</code></h4>
<p>å½“æˆ‘ä»¬åˆ¶ä½œå°†è¦äº§ç”Ÿ <code>Artifact</code>s çš„
<code>Run</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¯´æ˜å®ƒå±äºå“ªä¸ª <code>project</code>ã€‚</p>
<p>æ ¹æ®æ‚¨çš„å·¥ä½œæµç¨‹ï¼Œé¡¹ç›®å¯èƒ½å¤§åˆ°
<code>car-that-drives-itself</code>ï¼Œä¹Ÿå¯èƒ½å°åˆ°
<code>iterative-architecture-experiment-117</code>ã€‚</p>
<p>Depending on your workflow, a project might be as big as
<code>car-that-drives-itself</code> or as small as
<code>iterative-architecture-experiment-117</code>.</p>
<blockquote>
<p>ğŸ‘è§„åˆ™ï¼šå¦‚æœå¯ä»¥ï¼Œè¯·å°†æ‰€æœ‰å…±äº« <code>Artifact</code>s çš„
<code>Run</code>s ä¿ç•™åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚è¿™ä½¿äº‹æƒ…å˜å¾—ç®€å•ï¼Œä½†ä¸è¦æ‹…å¿ƒ
<code>Artifact</code>s å¯ä»¥è·¨é¡¹ç›®ç§»æ¤ï¼</p>
</blockquote>
<p>ä¸ºäº†å¸®åŠ©è·Ÿè¸ªæ‚¨å¯èƒ½è¿è¡Œçš„æ‰€æœ‰ä¸åŒç±»å‹çš„ä½œä¸šï¼Œåœ¨è¿›è¡Œ <code>Run</code>s
æ—¶æä¾› <code>job_type</code> å¾ˆæœ‰ç”¨ã€‚è¿™å¯ä»¥ä½¿æ‚¨çš„ Artifacts
å›¾è¡¨ä¿æŒæ•´æ´ã€‚</p>
<blockquote>
<p>ğŸ‘è§„åˆ™ï¼š<code>job_type</code>
åº”è¯¥æ˜¯æè¿°æ€§çš„ï¼Œå¹¶ä¸”å¯¹åº”äºä½ çš„ç®¡é“çš„å•ä¸ªæ­¥éª¤ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†
<code>load</code>ing æ•°æ®ä¸ <code>preprocess</code>ing æ•°æ®åˆ†å¼€ã€‚</p>
</blockquote>
<h4 id="wandb.artifact">ğŸº <code>wandb.Artifact</code></h4>
<p>è¦å°†æŸç‰©è®°å½•ä¸º <code>Artifact</code>ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆåˆ›å»ºä¸€ä¸ª
<code>Artifact</code> å¯¹è±¡ã€‚</p>
<p>æ¯ä¸ª <code>Artifact</code> éƒ½æœ‰ä¸€ä¸ª
<code>name</code>â€”â€”è¿™æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®çš„åç§°ã€‚</p>
<blockquote>
<p>ğŸ‘çš„è§„åˆ™ï¼š<code>name</code>
åº”è¯¥æ˜¯æè¿°æ€§çš„ï¼Œä½†æ˜“äºè®°å¿†å’Œè¾“å…¥â€”â€”æˆ‘ä»¬å–œæ¬¢ä½¿ç”¨è¿å­—ç¬¦åˆ†éš”çš„åç§°ï¼Œå¹¶ä¸ä»£ç ä¸­çš„å˜é‡åç›¸å¯¹åº”ã€‚</p>
</blockquote>
<p>å®ƒä¹Ÿæœ‰ä¸€ä¸ª <code>type</code>ã€‚å°±åƒ <code>Run</code>s çš„
<code>job_types</code> ä¸€æ ·ï¼Œå®ƒç”¨äºç»„ç»‡ <code>Run</code>s å’Œ
<code>Artifact</code>s çš„å›¾è¡¨ã€‚</p>
<blockquote>
<p>ğŸ‘çš„è§„åˆ™ï¼š<code>type</code> åº”è¯¥ç®€å•ï¼šæ¯”
<code>mnist-data-YYYYMMDD</code> æ›´åƒ <code>dataset</code> æˆ–
<code>model</code>ã€‚</p>
</blockquote>
<p>æ‚¨è¿˜å¯ä»¥é™„åŠ  <code>description</code> å’Œä¸€äº›
<code>metadata</code>ï¼Œä½œä¸ºå­—å…¸ã€‚<code>metadata</code> åªéœ€è¦å¯åºåˆ—åŒ–ä¸º
JSONã€‚</p>
<blockquote>
<p>ğŸ‘è§„åˆ™ï¼š<code>metadata</code>åº”å°½å¯èƒ½å…·æœ‰æè¿°æ€§ã€‚</p>
</blockquote>
<h4 id="artifact.new_file-and-run.log_artifact">ğŸ£
<code>artifact.new_file</code> and âœï¸ <code>run.log_artifact</code></h4>
<p>ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>Artifact</code>
å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å‘å®ƒæ·»åŠ æ–‡ä»¶ã€‚</p>
<p>æ‚¨æ²¡çœ‹é”™ï¼šå¸¦æœ‰ s çš„ <em>files</em>ã€‚<code>Artifact</code>s
çš„ç»“æ„ç±»ä¼¼äºç›®å½•ï¼ŒåŒ…å«æ–‡ä»¶å’Œå­ç›®å½•ã€‚</p>
<blockquote>
<p>ğŸ‘è§„åˆ™ï¼šåªè¦æœ‰å¿…è¦ï¼Œå°† <code>Artifact</code>
çš„å†…å®¹æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ã€‚å¦‚æœéœ€è¦æ‰©å±•ï¼Œè¿™å°†æœ‰æ‰€å¸®åŠ©ï¼</p>
</blockquote>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>new_file</code> æ–¹æ³•åŒæ—¶å†™å…¥æ–‡ä»¶å¹¶å°†å…¶é™„åŠ åˆ°
<code>Artifact</code>ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>add_file</code>
æ–¹æ³•ï¼Œå®ƒå°†è¿™ä¸¤ä¸ªæ­¥éª¤åˆ†å¼€</p>
<p>æ·»åŠ å®Œæ‰€æœ‰æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦å°† <code>log_artifact</code> æ·»åŠ åˆ° <a target="_blank" rel="noopener" href="https://wandb.ai/?_gl=1*r07jdw*_ga*MTUwMzMwNTA4NC4xNjg1MzI0NjI3*_ga_JH1SJHJQXJ*MTY4NjY1MzgzNC45LjEuMTY4NjY1MzgzOS41NS4wLjA.">wandb.ai</a>ã€‚</p>
<p>æ‚¨ä¼šæ³¨æ„åˆ°ä¸€äº› URL å‡ºç°åœ¨è¾“å‡ºä¸­ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç”¨äºè¿è¡Œé¡µé¢çš„
URLã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹ <code>Run</code> ç»“æœï¼ŒåŒ…æ‹¬å·²è®°å½•çš„ä»»ä½•
<code>Artifact</code>sã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨ä¸‹é¢çœ‹åˆ°ä¸€äº›ç¤ºä¾‹ï¼Œè¿™äº›ç¤ºä¾‹å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨â€œè¿è¡Œâ€é¡µé¢çš„å…¶ä»–ç»„ä»¶ã€‚</p>
<h3 id="use-a-logged-dataset-artifact">2ï¸âƒ£ Use a Logged Dataset
Artifact</h3>
<p>ä¸åšç‰©é¦†ä¸­çš„ artifacts ä¸åŒï¼ŒW&amp;B ä¸­çš„ <code>Artifact</code>s
æ—¨åœ¨ä½¿ç”¨ï¼Œè€Œä¸ä»…ä»…æ˜¯å­˜å‚¨ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<p>ä¸‹é¢çš„å•å…ƒæ ¼å®šä¹‰äº†ä¸€ä¸ªç®¡é“æ­¥éª¤ï¼Œè¯¥æ­¥éª¤æ¥æ”¶åŸå§‹æ•°æ®é›†å¹¶ä½¿ç”¨å®ƒæ¥ç”Ÿæˆ
<code>preprocess</code>ed æ•°æ®é›†ï¼š<code>normalize</code>d
å’Œæ­£ç¡®æ•´å½¢ã€‚</p>
<p>å†æ¬¡æ³¨æ„ï¼Œæˆ‘ä»¬ä»ä¸ <code>wandb</code>
æ¥å£çš„ä»£ç ä¸­åˆ†ç¦»å‡ºäº†ä»£ç çš„ä¸»ä½“ï¼Œå³ <code>preprocess</code>ã€‚</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess(dataset, normalize<span class="op">=</span><span class="va">True</span>, expand_dims<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">    ## Prepare the data</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> dataset.tensors</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> normalize:</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Scale images to the [0, 1] range</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x.<span class="bu">type</span>(torch.float32) <span class="op">/</span> <span class="dv">255</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> expand_dims:</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make sure images have shape (1, 28, 28)</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> torch.unsqueeze(x, <span class="dv">1</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> TensorDataset(x, y)</span></code></pre></div>
<p>ç°åœ¨æ˜¯ä½¿ç”¨ <code>wandb.Artifact</code> æ—¥å¿—è®°å½•è¿™ä¸ª
<code>preprocess</code> æ­¥éª¤çš„ä»£ç ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œä¸‹é¢çš„ç¤ºä¾‹éƒ½ <code>use</code>s äº†ä¸€ä¸ªæ–°çš„
<code>Artifact</code>ï¼Œå¹¶å°†å…¶ <code>log</code>s
ä¸‹æ¥ï¼Œè¿™ä¸ä¸Šä¸€æ­¥ç›¸åŒã€‚<code>Artifact</code>s æ—¢æ˜¯ <code>Run</code>s
çš„è¾“å…¥åˆæ˜¯è¾“å‡ºï¼</p>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ–°çš„
<code>job_type</code>ï¼Œ<code>preprocess-data</code>ï¼Œæ¥æ˜ç¡®è¿™æ˜¯ä¸€ä¸ªä¸åŒäºä¹‹å‰çš„
jobã€‚</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_and_log(steps):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> wandb.init(project<span class="op">=</span><span class="st">"artifacts-example"</span>, job_type<span class="op">=</span><span class="st">"preprocess-data"</span>) <span class="im">as</span> run:</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        processed_data <span class="op">=</span> wandb.Artifact(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mnist-preprocess"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"dataset"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Preprocessed MNIST dataset"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>            metadata<span class="op">=</span>steps)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># âœ”ï¸ declare which artifact we'll be using</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        raw_data_artifact <span class="op">=</span> run.use_artifact(<span class="st">'mnist-raw:latest'</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ğŸ“¥ if need be, download the artifact</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        raw_dataset <span class="op">=</span> raw_data_artifact.download()</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> split <span class="kw">in</span> [<span class="st">"training"</span>, <span class="st">"validation"</span>, <span class="st">"test"</span>]:</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>            raw_split <span class="op">=</span> read(raw_dataset, split)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>            processed_dataset <span class="op">=</span> preprocess(raw_split, <span class="op">**</span>steps)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> processed_data.new_file(split <span class="op">+</span> <span class="st">".pt"</span>, mode<span class="op">=</span><span class="st">"wb"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>                x, y <span class="op">=</span> processed_dataset.tensors</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>                torch.save((x, y), <span class="bu">file</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>        run.log_artifact(processed_data)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read(data_dir, split):</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> split <span class="op">+</span> <span class="st">".pt"</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> torch.load(os.path.join(data_dir, filename))</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> TensorDataset(x, y)</span></code></pre></div>
<p>è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä»¶äº‹æ˜¯é¢„å¤„ç†çš„ <code>steps</code> ä½œä¸º
<code>metadata</code> ä¸ <code>preprocessed_data</code> ä¸€èµ·ä¿å­˜ã€‚</p>
<p>å¦‚æœæ‚¨æƒ³è®©æ‚¨çš„å®éªŒå¯é‡ç°ï¼Œæ•è·å¤§é‡å…ƒæ•°æ®æ˜¯ä¸ªå¥½ä¸»æ„ï¼</p>
<p>æ­¤å¤–ï¼Œå³ä½¿æˆ‘ä»¬çš„æ•°æ®é›†æ˜¯
"<code>large artifact</code>"ï¼Œ<code>download</code>
æ­¥éª¤ä¹Ÿå¯ä»¥åœ¨ä¸åˆ°ä¸€ç§’çš„æ—¶é—´å†…å®Œæˆã€‚</p>
<p>å±•å¼€ä¸‹é¢çš„ markdown å•å…ƒæ ¼ä»¥äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>steps <span class="op">=</span> {<span class="st">"normalize"</span>: <span class="va">True</span>,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">"expand_dims"</span>: <span class="va">True</span>}</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>preprocess_and_log(steps)</span></code></pre></div>
<h4 id="run.use_artifact">âœ”ï¸ <code>run.use_artifact</code></h4>
<p>è¿™äº›æ­¥éª¤æ¯”è¾ƒç®€å•ã€‚æ¶ˆè´¹è€…åªéœ€è¦çŸ¥é“ <code>Artifact</code>
çš„<code>name</code>ï¼Œå†åŠ ä¸Š bit moreã€‚</p>
<p>â€œbit moreâ€ æ˜¯æ‚¨æƒ³è¦çš„ <code>Artifact</code> çš„ç‰¹å®šç‰ˆæœ¬çš„
<code>alias</code>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€åä¸Šä¼ çš„ç‰ˆæœ¬è¢«æ ‡è®°ä¸º<code>latest</code>ã€‚å¦åˆ™ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å¸¦æœ‰
<code>v0</code>/<code>v1</code>
ç­‰çš„æ—§ç‰ˆæœ¬ï¼Œæˆ–è€…æ‚¨å¯ä»¥æä¾›è‡ªå·±çš„åˆ«åï¼Œä¾‹å¦‚ <code>best</code> æˆ–
<code>jit-script</code>ã€‚å°±åƒ <a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker
Hub</a> æ ‡ç­¾ä¸€æ ·ï¼Œåˆ«åä¸åç§°ç”¨ <code>:</code> åˆ†éš”ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è¦çš„
<code>Artifact</code> æ˜¯ <code>mnist-raw:latest</code>ã€‚</p>
<blockquote>
<p>ğŸ‘è§„åˆ™ï¼šä¿æŒåˆ«åç®€çŸ­è€Œç”œç¾ã€‚å½“æ‚¨æƒ³è¦æ»¡è¶³æŸäº›å±æ€§çš„
<code>Artifact</code> æ—¶ï¼Œè¯·ä½¿ç”¨è‡ªå®šä¹‰ <code>alias</code>esï¼Œå¦‚
<code>latest</code> æˆ– <code>best</code></p>
</blockquote>
<h4 id="artifact.download">ğŸ“¥ <code>artifact.download</code></h4>
<p>ç°åœ¨ï¼Œæ‚¨å¯èƒ½æ­£åœ¨æ‹…å¿ƒ <code>download</code>
è°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬å†ä¸‹è½½ä¸€ä»½ï¼Œå†…å­˜çš„è´Ÿæ‹…ä¼šä¸ä¼šåŠ å€ï¼Ÿ</p>
<p>åˆ«æ‹…å¿ƒï¼Œæœ‹å‹ã€‚åœ¨æˆ‘ä»¬å®é™…ä¸‹è½½ä»»ä½•ä¸œè¥¿ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰æ­£ç¡®çš„ç‰ˆæœ¬ã€‚ä½¿ç”¨å’Œç‰ˆæœ¬æ§åˆ¶
<code>git</code> å’Œ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Torrent_file">torrenting</a>
ç›¸åŒçš„æŠ€æœ¯ï¼šhashingã€‚</p>
<p>éšç€ <code>Artifact</code>s çš„åˆ›å»ºå’Œè®°å½•ï¼Œå·¥ä½œç›®å½•ä¸­åä¸º
<code>artifacts</code> çš„æ–‡ä»¶å¤¹å°†å¼€å§‹å¡«å……å­ç›®å½•ï¼Œæ¯ä¸ª
<code>Artifact</code>ä¸€ä¸ªã€‚ä½¿ç”¨ <code>!tree artifacts</code>
æ£€æŸ¥å…¶å†…å®¹ï¼š</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>tree artifacts</span></code></pre></div>
<h4 id="the-artifacts-page-on-wandb.ai">ğŸŒ The Artifacts page on <a target="_blank" rel="noopener" href="https://wandb.ai/">wandb.ai</a></h4>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»è®°å½•å¹¶ä½¿ç”¨äº†ä¸€ä¸ª <code>Artifact</code>ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹
Run é¡µé¢ä¸Šçš„ Artifacts é€‰é¡¹å¡ã€‚</p>
<p>ä»<code>wandb</code> è¾“å‡ºå¯¼èˆªåˆ°è¿è¡Œé¡µé¢
URLï¼Œç„¶åä»å·¦ä¾§è¾¹æ ä¸­é€‰æ‹©â€œå·¥ä»¶â€é€‰é¡¹å¡ï¼ˆå®ƒæ˜¯å¸¦æœ‰æ•°æ®åº“å›¾æ ‡çš„é€‰é¡¹å¡ï¼Œçœ‹èµ·æ¥åƒä¸‰ä¸ªå†°çƒå åœ¨ä¸€èµ·ï¼‰ã€‚</p>
<p>å•å‡» "Input Artifacts" è¡¨æˆ– "Output Artifacts"
è¡¨ä¸­çš„ä¸€è¡Œï¼Œç„¶åæŸ¥çœ‹é€‰é¡¹å¡ï¼ˆ"Overview", "Metadata"ï¼‰ä»¥æŸ¥çœ‹è®°å½•çš„æœ‰å…³
<code>Artifact</code> çš„æ‰€æœ‰å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬ç‰¹åˆ«å–œæ¬¢ "Graph View"ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¾ç¤ºä¸€ä¸ªå›¾è¡¨ï¼Œå…¶ä¸­
<code>Artifact</code>s çš„ <code>type</code>s å’Œ <code>Run</code> çš„
<code>job_types</code> æ˜¯ä¸¤ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œç®­å¤´ä»£è¡¨æ¶ˆè´¹å’Œç”Ÿäº§ã€‚</p>
<h3 id="log-a-model">3ï¸âƒ£ Log a Model</h3>
<p>è¿™è¶³ä»¥äº†è§£ <code>Artifact</code>s çš„ API
å¦‚ä½•å·¥ä½œï¼Œä½†è®©æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªç¤ºä¾‹ä¸€ç›´åˆ°ç®¡é“çš„æœ«å°¾ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥äº†è§£
<code>Artifact</code>s å¦‚ä½•æ”¹è¿›æ‚¨çš„ ML å·¥ä½œæµç¨‹ã€‚</p>
<p>è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼åœ¨ PyTorch ä¸­æ„å»ºäº†ä¸€ä¸ª DNN
<code>model</code>â€”â€”ä¸€ä¸ªéå¸¸ç®€å•çš„ ConvNetã€‚</p>
<p>æˆ‘ä»¬å°†ä»åˆå§‹åŒ– <code>model</code>
å¼€å§‹ï¼Œè€Œä¸æ˜¯è®­ç»ƒå®ƒã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤è®­ç»ƒï¼ŒåŒæ—¶ä¿æŒå…¶ä»–ä¸€åˆ‡ä¸å˜ã€‚</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> floor</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConvNet(nn.Module):</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, hidden_layer_sizes<span class="op">=</span>[<span class="dv">32</span>, <span class="dv">64</span>],</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                  kernel_sizes<span class="op">=</span>[<span class="dv">3</span>],</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                  activation<span class="op">=</span><span class="st">"ReLU"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                  pool_sizes<span class="op">=</span>[<span class="dv">2</span>],</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                  dropout<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                  num_classes<span class="op">=</span>num_classes,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                  input_shape<span class="op">=</span>input_shape):</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(ConvNet, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.layer1 <span class="op">=</span> nn.Sequential(</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>              nn.Conv2d(in_channels<span class="op">=</span>input_shape[<span class="dv">0</span>], out_channels<span class="op">=</span>hidden_layer_sizes[<span class="dv">0</span>], kernel_size<span class="op">=</span>kernel_sizes[<span class="dv">0</span>]),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>              <span class="bu">getattr</span>(nn, activation)(),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>              nn.MaxPool2d(kernel_size<span class="op">=</span>pool_sizes[<span class="dv">0</span>])</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.layer2 <span class="op">=</span> nn.Sequential(</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>              nn.Conv2d(in_channels<span class="op">=</span>hidden_layer_sizes[<span class="dv">0</span>], out_channels<span class="op">=</span>hidden_layer_sizes[<span class="op">-</span><span class="dv">1</span>], kernel_size<span class="op">=</span>kernel_sizes[<span class="op">-</span><span class="dv">1</span>]),</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>              <span class="bu">getattr</span>(nn, activation)(),</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>              nn.MaxPool2d(kernel_size<span class="op">=</span>pool_sizes[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.layer3 <span class="op">=</span> nn.Sequential(</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>              nn.Flatten(),</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>              nn.Dropout(dropout)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>        fc_input_dims <span class="op">=</span> floor((input_shape[<span class="dv">1</span>] <span class="op">-</span> kernel_sizes[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> pool_sizes[<span class="dv">0</span>]) <span class="co"># layer 1 output size</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>        fc_input_dims <span class="op">=</span> floor((fc_input_dims <span class="op">-</span> kernel_sizes[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> pool_sizes[<span class="op">-</span><span class="dv">1</span>]) <span class="co"># layer 2 output size</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>        fc_input_dims <span class="op">=</span> fc_input_dims<span class="op">*</span>fc_input_dims<span class="op">*</span>hidden_layer_sizes[<span class="op">-</span><span class="dv">1</span>] <span class="co"># layer 3 output size</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc <span class="op">=</span> nn.Linear(fc_input_dims, num_classes)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.layer1(x)</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.layer2(x)</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.layer3(x)</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.fc(x)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span></code></pre></div>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ W&amp;B æ¥è·Ÿè¸ªè¿è¡Œï¼Œå› æ­¤ä½¿ç”¨
<code>wandb.config</code> å¯¹è±¡æ¥å­˜å‚¨æ‰€æœ‰è¶…å‚æ•°ã€‚</p>
<p>è¯¥ <code>config</code> å¯¹è±¡çš„ <code>dict</code>ionary
ç‰ˆæœ¬æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ <code>metadata</code>ï¼Œæ‰€ä»¥ä¸€å®šè¦åŒ…å«å®ƒï¼</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_model_and_log(config):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> wandb.init(project<span class="op">=</span><span class="st">"artifacts-example"</span>, job_type<span class="op">=</span><span class="st">"initialize"</span>, config<span class="op">=</span>config) <span class="im">as</span> run:</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        config <span class="op">=</span> wandb.config</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> ConvNet(<span class="op">**</span>config)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        model_artifact <span class="op">=</span> wandb.Artifact(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"convnet"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"model"</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Simple AlexNet style CNN"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>            metadata<span class="op">=</span><span class="bu">dict</span>(config))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        torch.save(model.state_dict(), <span class="st">"initialized_model.pth"</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># â• another way to add a file to an Artifact</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>        model_artifact.add_file(<span class="st">"initialized_model.pth"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        wandb.save(<span class="st">"initialized_model.pth"</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        run.log_artifact(model_artifact)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>model_config <span class="op">=</span> {<span class="st">"hidden_layer_sizes"</span>: [<span class="dv">32</span>, <span class="dv">64</span>],</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"kernel_sizes"</span>: [<span class="dv">3</span>],</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"activation"</span>: <span class="st">"ReLU"</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pool_sizes"</span>: [<span class="dv">2</span>],</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">"dropout"</span>: <span class="fl">0.5</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">"num_classes"</span>: <span class="dv">10</span>}</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>build_model_and_log(model_config)</span></code></pre></div>
<h4 id="artifact.add_file">â• <code>artifact.add_file</code></h4>
<p>ä¸åœ¨æ•°æ®é›†æ—¥å¿—è®°å½•ç¤ºä¾‹ä¸­åŒæ—¶ç¼–å†™ <code>new_file</code> å¹¶å°†å…¶æ·»åŠ åˆ°
<code>Artifact</code> ä¸åŒï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸€æ­¥å†™å…¥æ–‡ä»¶ï¼ˆæ­¤å¤„ä¸º
<code>torch.save</code>ï¼‰ï¼Œç„¶ååœ¨å¦ä¸€æ­¥ä¸­å°†å®ƒä»¬ <code>add</code> åˆ°
<code>Artifact</code>ã€‚</p>
<blockquote>
<p>ğŸ‘è§„åˆ™ï¼šå°½å¯èƒ½ä½¿ç”¨ <code>new_file</code>ï¼Œä»¥é˜²æ­¢é‡å¤ã€‚</p>
</blockquote>
<h3 id="use-a-logged-model-artifact">4ï¸âƒ£ Use a Logged Model Artifact</h3>
<p>å°±åƒæˆ‘ä»¬å¯ä»¥åœ¨ <code>dataset</code> ä¸Šè°ƒç”¨ <code>use_artifact</code>
ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ <code>initialized_model</code>
ä¸Šè°ƒç”¨å®ƒä»¥åœ¨å¦ä¸€ä¸ªè¿è¡Œä¸­ä½¿ç”¨å®ƒã€‚</p>
<p>è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬ <code>train</code> <code>model</code>ã€‚</p>
<p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬å…³äº <a target="_blank" rel="noopener" href="http://wandb.me/pytorch-colab">instrumenting W&amp;B with
PyTorch</a> çš„ Colabã€‚</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(model, train_loader, valid_loader, config):</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> <span class="bu">getattr</span>(torch.optim, config.optimizer)(model.parameters())</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    model.train()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    example_ct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(config.epochs):</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> batch_idx, (data, target) <span class="kw">in</span> <span class="bu">enumerate</span>(train_loader):</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>            data, target <span class="op">=</span> data.to(device), target.to(device)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>            optimizer.zero_grad()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> model(data)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> F.cross_entropy(output, target)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>            loss.backward()</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>            optimizer.step()</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>            example_ct <span class="op">+=</span> <span class="bu">len</span>(data)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> batch_idx <span class="op">%</span> config.batch_log_interval <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'Train Epoch: </span><span class="sc">{}</span><span class="st"> [</span><span class="sc">{}</span><span class="st">/</span><span class="sc">{}</span><span class="st"> (</span><span class="sc">{:.0%}</span><span class="st">)]</span><span class="ch">\t</span><span class="st">Loss: </span><span class="sc">{:.6f}</span><span class="st">'</span>.<span class="bu">format</span>(</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>                    epoch, batch_idx <span class="op">*</span> <span class="bu">len</span>(data), <span class="bu">len</span>(train_loader.dataset),</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                    batch_idx <span class="op">/</span> <span class="bu">len</span>(train_loader), loss.item()))</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                train_log(loss, example_ct, epoch)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># evaluate the model on the validation set at each epoch</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>        loss, accuracy <span class="op">=</span> test(model, valid_loader)  </span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>        test_log(loss, accuracy, example_ct, epoch)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test(model, test_loader):</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    test_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> data, target <span class="kw">in</span> test_loader:</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>            data, target <span class="op">=</span> data.to(device), target.to(device)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> model(data)</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>            test_loss <span class="op">+=</span> F.cross_entropy(output, target, reduction<span class="op">=</span><span class="st">'sum'</span>)  <span class="co"># sum up batch loss</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> output.argmax(dim<span class="op">=</span><span class="dv">1</span>, keepdim<span class="op">=</span><span class="va">True</span>)  <span class="co"># get the index of the max log-probability</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>            correct <span class="op">+=</span> pred.eq(target.view_as(pred)).<span class="bu">sum</span>()</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>    test_loss <span class="op">/=</span> <span class="bu">len</span>(test_loader.dataset)</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> <span class="fl">100.</span> <span class="op">*</span> correct <span class="op">/</span> <span class="bu">len</span>(test_loader.dataset)</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> test_loss, accuracy</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_log(loss, example_ct, epoch):</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> <span class="bu">float</span>(loss)</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># where the magic happens</span></span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>    wandb.log({<span class="st">"epoch"</span>: epoch, <span class="st">"train/loss"</span>: loss}, step<span class="op">=</span>example_ct)</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Loss after "</span> <span class="op">+</span> <span class="bu">str</span>(example_ct).zfill(<span class="dv">5</span>) <span class="op">+</span> <span class="ss">f" examples: </span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_log(loss, accuracy, example_ct, epoch):</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> <span class="bu">float</span>(loss)</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> <span class="bu">float</span>(accuracy)</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># where the magic happens</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>    wandb.log({<span class="st">"epoch"</span>: epoch, <span class="st">"validation/loss"</span>: loss, <span class="st">"validation/accuracy"</span>: accuracy}, step<span class="op">=</span>example_ct)</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Loss/accuracy after "</span> <span class="op">+</span> <span class="bu">str</span>(example_ct).zfill(<span class="dv">5</span>) <span class="op">+</span> <span class="ss">f" examples: </span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">/</span><span class="sc">{</span>accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div>
<p>è¿™æ¬¡æˆ‘ä»¬å°†è¿è¡Œä¸¤ä¸ªç‹¬ç«‹çš„ <code>Artifact</code> ç”Ÿäº§
<code>Run</code>sã€‚</p>
<p>ä¸€æ—¦ç¬¬ä¸€ä¸ªå®Œæˆ <code>train</code>ing
<code>model</code>ï¼Œç¬¬äºŒä¸ªå°†é€šè¿‡è¯„ä¼°å…¶åœ¨ <code>test_dataset</code>
ä¸Šçš„æ€§èƒ½æ¥ä½¿ç”¨ <code>trained-model</code> <code>Artifact</code>ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å°†æå–ç½‘ç»œæœ€æ··ä¹±çš„ 32
ä¸ªç¤ºä¾‹â€”â€”åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œ<code>categorical_crossentropy</code> æœ€é«˜ã€‚</p>
<p>è¿™æ˜¯è¯Šæ–­æ•°æ®é›†å’Œæ¨¡å‹é—®é¢˜çš„å¥½æ–¹æ³•ï¼</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate(model, test_loader):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">    ## Evaluate the trained model</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    loss, accuracy <span class="op">=</span> test(model, test_loader)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    highest_losses, hardest_examples, true_labels, predictions <span class="op">=</span> get_hardest_k_examples(model, test_loader.dataset)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> loss, accuracy, highest_losses, hardest_examples, true_labels, predictions</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_hardest_k_examples(model, testing_set, k<span class="op">=</span><span class="dv">32</span>):</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    loader <span class="op">=</span> DataLoader(testing_set, <span class="dv">1</span>, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the losses and predictions for each item in the dataset</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    losses <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> data, target <span class="kw">in</span> loader:</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>            data, target <span class="op">=</span> data.to(device), target.to(device)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> model(data)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> F.cross_entropy(output, target)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> output.argmax(dim<span class="op">=</span><span class="dv">1</span>, keepdim<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> losses <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>                losses <span class="op">=</span> loss.view((<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>                predictions <span class="op">=</span> pred</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>                losses <span class="op">=</span> torch.cat((losses, loss.view((<span class="dv">1</span>, <span class="dv">1</span>))), <span class="dv">0</span>)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>                predictions <span class="op">=</span> torch.cat((predictions, pred), <span class="dv">0</span>)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    argsort_loss <span class="op">=</span> torch.argsort(losses, dim<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    highest_k_losses <span class="op">=</span> losses[argsort_loss[<span class="op">-</span>k:]]</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    hardest_k_examples <span class="op">=</span> testing_set[argsort_loss[<span class="op">-</span>k:]][<span class="dv">0</span>]</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    true_labels <span class="op">=</span> testing_set[argsort_loss[<span class="op">-</span>k:]][<span class="dv">1</span>]</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    predicted_labels <span class="op">=</span> predictions[argsort_loss[<span class="op">-</span>k:]]</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> highest_k_losses, hardest_k_examples, true_labels, predicted_labels</span></code></pre></div>
<p>è¿™äº›æ—¥å¿—è®°å½•åŠŸèƒ½ä¸ä¼šæ·»åŠ ä»»ä½•æ–°çš„ <code>Artifact</code>
åŠŸèƒ½ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šå¯¹å…¶è¿›è¡Œè¯„è®ºï¼šæˆ‘ä»¬åªæ˜¯åœ¨ä½¿ç”¨ã€ä¸‹è½½å’Œè®°å½•
<code>Artifact</code>sã€‚</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_and_log(config):</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> wandb.init(project<span class="op">=</span><span class="st">"artifacts-example"</span>, job_type<span class="op">=</span><span class="st">"train"</span>, config<span class="op">=</span>config) <span class="im">as</span> run:</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        config <span class="op">=</span> wandb.config</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> run.use_artifact(<span class="st">'mnist-preprocess:latest'</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        data_dir <span class="op">=</span> data.download()</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        training_dataset <span class="op">=</span>  read(data_dir, <span class="st">"training"</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        validation_dataset <span class="op">=</span> read(data_dir, <span class="st">"validation"</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>        train_loader <span class="op">=</span> DataLoader(training_dataset, batch_size<span class="op">=</span>config.batch_size)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        validation_loader <span class="op">=</span> DataLoader(validation_dataset, batch_size<span class="op">=</span>config.batch_size)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>        model_artifact <span class="op">=</span> run.use_artifact(<span class="st">"convnet:latest"</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>        model_dir <span class="op">=</span> model_artifact.download()</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        model_path <span class="op">=</span> os.path.join(model_dir, <span class="st">"initialized_model.pth"</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        model_config <span class="op">=</span> model_artifact.metadata</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>        config.update(model_config)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> ConvNet(<span class="op">**</span>model_config)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        model.load_state_dict(torch.load(model_path))</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> model.to(device)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>        train(model, train_loader, validation_loader, config)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        model_artifact <span class="op">=</span> wandb.Artifact(</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"trained-model"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"model"</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="st">"Trained NN model"</span>,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>            metadata<span class="op">=</span><span class="bu">dict</span>(model_config))</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>        torch.save(model.state_dict(), <span class="st">"trained_model.pth"</span>)</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>        model_artifact.add_file(<span class="st">"trained_model.pth"</span>)</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>        wandb.save(<span class="st">"trained_model.pth"</span>)</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>        run.log_artifact(model_artifact)</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_and_log(config<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> wandb.init(project<span class="op">=</span><span class="st">"artifacts-example"</span>, job_type<span class="op">=</span><span class="st">"report"</span>, config<span class="op">=</span>config) <span class="im">as</span> run:</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> run.use_artifact(<span class="st">'mnist-preprocess:latest'</span>)</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>        data_dir <span class="op">=</span> data.download()</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>        testing_set <span class="op">=</span> read(data_dir, <span class="st">"test"</span>)</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>        test_loader <span class="op">=</span> torch.utils.data.DataLoader(testing_set, batch_size<span class="op">=</span><span class="dv">128</span>, shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>        model_artifact <span class="op">=</span> run.use_artifact(<span class="st">"trained-model:latest"</span>)</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>        model_dir <span class="op">=</span> model_artifact.download()</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>        model_path <span class="op">=</span> os.path.join(model_dir, <span class="st">"trained_model.pth"</span>)</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>        model_config <span class="op">=</span> model_artifact.metadata</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> ConvNet(<span class="op">**</span>model_config)</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>        model.load_state_dict(torch.load(model_path))</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>        model.to(device)</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>        loss, accuracy, highest_losses, hardest_examples, true_labels, preds <span class="op">=</span> evaluate(model, test_loader)</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>        run.summary.update({<span class="st">"loss"</span>: loss, <span class="st">"accuracy"</span>: accuracy})</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>        wandb.log({<span class="st">"high-loss-examples"</span>:</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>            [wandb.Image(hard_example, caption<span class="op">=</span><span class="bu">str</span>(<span class="bu">int</span>(pred)) <span class="op">+</span> <span class="st">","</span> <span class="op">+</span>  <span class="bu">str</span>(<span class="bu">int</span>(label)))</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> hard_example, pred, label <span class="kw">in</span> <span class="bu">zip</span>(hardest_examples, preds, true_labels)]})</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>train_config <span class="op">=</span> {<span class="st">"batch_size"</span>: <span class="dv">128</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"epochs"</span>: <span class="dv">5</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">"batch_log_interval"</span>: <span class="dv">25</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"optimizer"</span>: <span class="st">"Adam"</span>}</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> train_and_log(train_config)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>evaluate_and_log()</span></code></pre></div>
<h4 id="the-graph-view">ğŸ” The Graph View</h4>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ›´æ”¹äº† <code>Artifact</code> çš„ <code>type</code>ï¼šè¿™äº›
<code>Run</code>s ä½¿ç”¨çš„æ˜¯æ¨¡å‹ï¼Œè€Œä¸æ˜¯æ•°æ®é›†ã€‚åœ¨ Artifacts
é¡µé¢çš„å›¾å½¢è§†å›¾ä¸­ï¼Œç”Ÿäº§æ¨¡å‹çš„ <code>Run</code>s å°†ä¸ç”Ÿæˆ
<code>dataset</code>s çš„è¿è¡Œåˆ†å¼€ã€‚</p>
<p>å»çœ‹çœ‹å§ï¼å’Œä»¥å‰ä¸€æ ·ï¼Œæ‚¨éœ€è¦å‰å¾€ Run é¡µé¢ï¼Œä»å·¦ä¾§æ ä¸­é€‰æ‹© "Artifacts"
é€‰é¡¹å¡ï¼Œé€‰æ‹©ä¸€ä¸ª <code>Artifact</code>ï¼Œç„¶åå•å‡» "Graph View"
é€‰é¡¹å¡ã€‚</p>
<h4 id="exploded-graphs">ğŸ’£ Exploded Graphs</h4>
<p>æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°æ ‡æœ‰â€œçˆ†ç‚¸â€çš„æŒ‰é’®ã€‚ä¸è¦ç‚¹å‡»å®ƒï¼Œå› ä¸ºå®ƒä¼šåœ¨ W&amp;B
æ€»éƒ¨æ‚¨ä¸èµ·çœ¼çš„ä½œè€…åŠå…¬æ¡Œä¸‹å¼•çˆ†ä¸€æšå°ç‚¸å¼¹ï¼</p>
<p>åªæ˜¯åœ¨å¼€ç©ç¬‘ã€‚å®ƒä»¥æ›´æ¸©å’Œçš„æ–¹å¼â€œåˆ†è§£â€å›¾è¡¨ï¼š<code>Artifact</code>s å’Œ
<code>Run</code>s åœ¨å•ä¸ªå®ä¾‹çº§åˆ«è€Œä¸æ˜¯ç±»å‹çº§åˆ«åˆ†ç¦»ï¼šèŠ‚ç‚¹ä¸æ˜¯
<code>dataset</code> å’Œ <code>load-data</code>ï¼Œè€Œæ˜¯
<code>dataset:mnist-raw:v1</code> å’Œ
<code>load-data:sunny-smoke-1</code>ï¼Œç­‰ç­‰ã€‚</p>
<p>è¿™æä¾›äº†å¯¹æ‚¨çš„ç®¡é“çš„å…¨é¢æ´å¯Ÿï¼Œè®°å½•çš„æŒ‡æ ‡ã€å…ƒæ•°æ®ç­‰éƒ½è§¦æ‰‹å¯åŠâ€”â€”æ‚¨ä»…å—é™äºæ‚¨é€‰æ‹©ä¸æˆ‘ä»¬ä¸€èµ·è®°å½•çš„å†…å®¹ã€‚</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">åŸ¹æ ¹è¯·åŠ è›‹</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://blog.lfd-world.online/2023/06/12/wandb-xue-xi-ri-ji-yi-doc/">https://blog.lfd-world.online/2023/06/12/wandb-xue-xi-ri-ji-yi-doc/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">åŸ¹æ ¹è¯·åŠ è›‹</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/WandB/">
                                    <span class="chip bg-color">WandB</span>
                                </a>
                            
                                <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">
                                    <span class="chip bg-color">æ·±åº¦å­¦ä¹ </span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">ä½ çš„èµè¯†æ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2023/06/16/gai-lu-lun-yi-bei-xie-si-ding-li/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="æ¦‚ç‡è®ºï¼ˆä¸€ï¼‰ è´å¶æ–¯å…¬å¼">
                        
                        <span class="card-title">æ¦‚ç‡è®ºï¼ˆä¸€ï¼‰ è´å¶æ–¯å…¬å¼</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            æ¦‚ç‡è®º è´å¶æ–¯å…¬å¼
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-06-16
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%A6%82%E7%8E%87/" class="post-category">
                                    æ¦‚ç‡
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%A6%82%E7%8E%87/">
                        <span class="chip bg-color">æ¦‚ç‡</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/06/04/github-pages-ge-ren-bo-ke-da-jian-san-typora-teng-xun-yun-tu-chuang/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="Github Pages + Hexo + Vercel ä¸ªäººåšå®¢æ­å»ºï¼ˆä¸‰ï¼‰Typora + PicGo+ è…¾è®¯äº‘å›¾åºŠ">
                        
                        <span class="card-title">Github Pages + Hexo + Vercel ä¸ªäººåšå®¢æ­å»ºï¼ˆä¸‰ï¼‰Typora + PicGo+ è…¾è®¯äº‘å›¾åºŠ</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Typora + PicGo + è…¾è®¯äº‘å›¾åºŠ
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-06-04
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Blog/" class="post-category">
                                    Blog
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Blog/">
                        <span class="chip bg-color">Blog</span>
                    </a>
                    
                    <a href="/tags/Hexo/">
                        <span class="chip bg-color">Hexo</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'æ¥æº: åŸ¹æ ¹è¯·åŠ è›‹<br />'
            + 'æ–‡ç« ä½œè€…: åŸ¹æ ¹è¯·åŠ è›‹<br />'
            + 'æ–‡ç« é“¾æ¥: <a href="' + url + '">' + url + '</a><br />'
            + 'æœ¬æ–‡ç« è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½éƒ½è¯·æ³¨æ˜å‡ºå¤„ã€‚';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023</span>
            
            <a href="/about" target="_blank">åŸ¹æ ¹è¯·åŠ è›‹</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;<span
                        class="white-color">24.6k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- è¿è¡Œå¤©æ•°æé†’. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/LFD-byte" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:huifali@163.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- ç™½å¤©å’Œé»‘å¤œä¸»é¢˜ -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- é›ªèŠ±ç‰¹æ•ˆ -->
    

    <!-- é¼ æ ‡æ˜Ÿæ˜Ÿç‰¹æ•ˆ -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--è…¾è®¯å…”å°å·¢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
